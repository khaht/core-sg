1c0409a6a274ffd9f0925807343129eb
_getJestObj().mock('utils/policy.util');

function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");

  _getJestObj = () => jest;

  return jest;
}

const routerChecker = require('../router/utils/routerChecker');

const logger = require('utils/logger.util');

const _ = require('lodash');

const initializeApp = () => {
  global.sgApp = {
    log: logger,
    stopWithError: jest.fn(() => {
      throw new Error('error');
    }),
    controllers: {
      auth: {
        login: jest.fn(),
        identity: 'Auth'
      }
    },
    api: {
      auth: {
        controllers: {
          auth: {
            identity: 'Auth',
            log: {}
          }
        },
        config: {
          routes: [{
            method: 'POST',
            path: '/login',
            handler: 'auth.login',
            config: {
              policies: ['global::validator'],
              validator: 'validateLoginUserInput'
            }
          }]
        }
      }
    }
  };
};

describe('Router checker', () => {
  beforeEach(() => {
    initializeApp();
  });
  test('should return router', () => {
    const policyUtils = require('utils/policy.util');

    policyUtils.globalPolicy = jest.fn(() => 'globalPolicy');
    policyUtils.get = jest.fn(() => 'policyUtils');
    const route = {
      method: 'POST',
      path: '/login',
      handler: 'auth.login',
      config: {
        policies: ['global::validator'],
        validator: 'validateLoginUserInput'
      }
    };
    const resp = routerChecker(sgApp)(route);
    expect(Object.keys(resp)).toEqual(['method', 'endpoint', 'policies', 'action']);
  });
  test('should throw error if controller is not found', () => {
    const policyUtils = require('utils/policy.util');

    policyUtils.globalPolicy = jest.fn(() => 'globalPolicy');
    policyUtils.get = jest.fn(() => 'policyUtils');
    sgApp.controllers = {};
    const route = {
      method: 'POST',
      path: '/login',
      handler: 'auth.login',
      config: {
        policies: ['global::validator'],
        validator: 'validateLoginUserInput'
      }
    };

    try {
      routerChecker(sgApp)(route);
    } catch (error) {
      expect(error.message).toBe('error');
    }
  });
  test('should throw error if action controller is not function', () => {
    const policyUtils = require('utils/policy.util');

    policyUtils.globalPolicy = jest.fn(() => 'globalPolicy');
    policyUtils.get = jest.fn(() => 'policyUtils');
    sgApp.controllers = {
      auth: {
        login: 'login',
        identity: 'Auth'
      }
    };
    const route = {
      method: 'POST',
      path: '/login',
      handler: 'auth.login',
      config: {
        policies: ['global::validator'],
        validator: 'validateLoginUserInput'
      }
    };

    try {
      routerChecker(sgApp)(route);
    } catch (error) {
      expect(error.message).toBe('error');
    }
  });
  test('should throw error if create endpoint fail', () => {
    const policyUtils = require('utils/policy.util');

    policyUtils.globalPolicy = jest.fn(() => 'globalPolicy');
    policyUtils.get = jest.fn(() => {
      throw new Error('error');
    });
    const route = {
      method: 'POST',
      path: '/login',
      handler: 'auth.login',
      config: {
        policies: 'global::validator',
        validator: 'validateLoginUserInput'
      }
    };

    try {
      routerChecker(sgApp)(route);
    } catch (error) {
      expect(error.message).toBe('error');
    }
  });
  test('should not get policy util if config policies is undefined ', () => {
    const policyUtils = require('utils/policy.util');

    policyUtils.globalPolicy = jest.fn(() => 'globalPolicy');
    policyUtils.get = jest.fn(() => {
      throw new Error('error');
    });
    const route = {
      method: 'POST',
      path: '/login',
      handler: 'auth.login',
      config: {
        policies: undefined,
        validator: 'validateLoginUserInput'
      }
    };
    const resp = routerChecker(sgApp)(route);
    expect(Object.keys(resp)).toEqual(['method', 'endpoint', 'policies', 'action']);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdXRlci51dGlscy5yb3V0ZXJDaGVja2VyLnRlc3QuanMiXSwibmFtZXMiOlsibW9jayIsInJvdXRlckNoZWNrZXIiLCJyZXF1aXJlIiwibG9nZ2VyIiwiXyIsImluaXRpYWxpemVBcHAiLCJnbG9iYWwiLCJzZ0FwcCIsImxvZyIsInN0b3BXaXRoRXJyb3IiLCJqZXN0IiwiZm4iLCJFcnJvciIsImNvbnRyb2xsZXJzIiwiYXV0aCIsImxvZ2luIiwiaWRlbnRpdHkiLCJhcGkiLCJjb25maWciLCJyb3V0ZXMiLCJtZXRob2QiLCJwYXRoIiwiaGFuZGxlciIsInBvbGljaWVzIiwidmFsaWRhdG9yIiwiZGVzY3JpYmUiLCJiZWZvcmVFYWNoIiwidGVzdCIsInBvbGljeVV0aWxzIiwiZ2xvYmFsUG9saWN5IiwiZ2V0Iiwicm91dGUiLCJyZXNwIiwiZXhwZWN0IiwiT2JqZWN0Iiwia2V5cyIsInRvRXF1YWwiLCJlcnJvciIsIm1lc3NhZ2UiLCJ0b0JlIiwidW5kZWZpbmVkIl0sIm1hcHBpbmdzIjoiQUFJQSxjQUFLQSxJQUFMLENBQVUsbUJBQVY7Ozs7Ozs7Ozs7OztBQUpBLE1BQU1DLGFBQWEsR0FBR0MsT0FBTyxDQUFDLCtCQUFELENBQTdCOztBQUNBLE1BQU1DLE1BQU0sR0FBR0QsT0FBTyxDQUFDLG1CQUFELENBQXRCOztBQUNBLE1BQU1FLENBQUMsR0FBR0YsT0FBTyxDQUFDLFFBQUQsQ0FBakI7O0FBSUEsTUFBTUcsYUFBYSxHQUFHLE1BQU07QUFDMUJDLEVBQUFBLE1BQU0sQ0FBQ0MsS0FBUCxHQUFlO0FBQ2JDLElBQUFBLEdBQUcsRUFBRUwsTUFEUTtBQUViTSxJQUFBQSxhQUFhLEVBQUVDLElBQUksQ0FBQ0MsRUFBTCxDQUFRLE1BQU07QUFDM0IsWUFBTSxJQUFJQyxLQUFKLENBQVUsT0FBVixDQUFOO0FBQ0QsS0FGYyxDQUZGO0FBS2JDLElBQUFBLFdBQVcsRUFBRTtBQUFFQyxNQUFBQSxJQUFJLEVBQUU7QUFBRUMsUUFBQUEsS0FBSyxFQUFFTCxJ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SSxFQUFFLFFBRk07QUFHWkMsTUFBQUEsT0FBTyxFQUFFLFlBSEc7QUFJWkosTUFBQUEsTUFBTSxFQUFFO0FBQ05LLFFBQUFBLFFBQVEsRUFBRWlCLFNBREo7QUFFTmhCLFFBQUFBLFNBQVMsRUFBRTtBQUZMO0FBSkksS0FBZDtBQVVBLFVBQU1RLElBQUksR0FBRy9CLGFBQWEsQ0FBQ00sS0FBRCxDQUFiLENBQXFCd0IsS0FBckIsQ0FBYjtBQUNBRSxJQUFBQSxNQUFNLENBQUNDLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZSCxJQUFaLENBQUQsQ0FBTixDQUEwQkksT0FBMUIsQ0FBa0MsQ0FDaEMsUUFEZ0MsRUFFaEMsVUFGZ0MsRUFHaEMsVUFIZ0MsRUFJaEMsUUFKZ0MsQ0FBbEM7QUFNRCxHQXhCRyxDQUFKO0FBeUJELENBNUhPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCByb3V0ZXJDaGVja2VyID0gcmVxdWlyZSgnLi4vcm91dGVyL3V0aWxzL3JvdXRlckNoZWNrZXInKTtcbmNvbnN0IGxvZ2dlciA9IHJlcXVpcmUoJ3V0aWxzL2xvZ2dlci51dGlsJyk7XG5jb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG5cbmplc3QubW9jaygndXRpbHMvcG9saWN5LnV0aWwnKTtcblxuY29uc3QgaW5pdGlhbGl6ZUFwcCA9ICgpID0+IHtcbiAgZ2xvYmFsLnNnQXBwID0ge1xuICAgIGxvZzogbG9nZ2VyLFxuICAgIHN0b3BXaXRoRXJyb3I6IGplc3QuZm4oKCkgPT4ge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdlcnJvcicpO1xuICAgIH0pLFxuICAgIGNvbnRyb2xsZXJzOiB7IGF1dGg6IHsgbG9naW46IGplc3QuZm4oKSwgaWRlbnRpdHk6ICdBdXRoJyB9IH0sXG4gICAgYXBpOiB7XG4gICAgICBhdXRoOiB7XG4gICAgICAgIGNvbnRyb2xsZXJzOiB7XG4gICAgICAgICAgYXV0aDoge1xuICAgICAgICAgICAgaWRlbnRpdHk6ICdBdXRoJyxcbiAgICAgICAgICAgIGxvZzoge30sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgcm91dGVzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICBwYXRoOiAnL2xvZ2luJyxcbiAgICAgICAgICAgICAgaGFuZGxlcjogJ2F1dGgubG9naW4nLFxuICAgICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICBwb2xpY2llczogWydnbG9iYWw6OnZhbGlkYXRvciddLFxuICAgICAgICAgICAgICAgIHZhbGlkYXRvcjogJ3ZhbGlkYXRlTG9naW5Vc2VySW5wdXQnLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xufTtcblxuZGVzY3JpYmUoJ1JvdXRlciBjaGVja2VyJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBpbml0aWFsaXplQXBwKCk7XG4gIH0pO1xuICB0ZXN0KCdzaG91bGQgcmV0dXJuIHJvdXRlcicsICgpID0+IHtcbiAgICBjb25zdCBwb2xpY3lVdGlscyA9IHJlcXVpcmUoJ3V0aWxzL3BvbGljeS51dGlsJyk7XG4gICAgcG9saWN5VXRpbHMuZ2xvYmFsUG9saWN5ID0gamVzdC5mbigoKSA9PiAnZ2xvYmFsUG9saWN5Jyk7XG4gICAgcG9saWN5VXRpbHMuZ2V0ID0gamVzdC5mbigoKSA9PiAncG9saWN5VXRpbHMnKTtcblxuICAgIGNvbnN0IHJvdXRlID0ge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBwYXRoOiAnL2xvZ2luJyxcbiAgICAgIGhhbmRsZXI6ICdhdXRoLmxvZ2luJyxcbiAgICAgIGNvbmZpZzoge1xuICAgICAgICBwb2xpY2llczogWydnbG9iYWw6OnZhbGlkYXRvciddLFxuICAgICAgICB2YWxpZGF0b3I6ICd2YWxpZGF0ZUxvZ2luVXNlcklucHV0JyxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IHJlc3AgPSByb3V0ZXJDaGVja2VyKHNnQXBwKShyb3V0ZSk7XG4gICAgZXhwZWN0KE9iamVjdC5rZXlzKHJlc3ApKS50b0VxdWFsKFtcbiAgICAgICdtZXRob2QnLFxuICAgICAgJ2VuZHBvaW50JyxcbiAgICAgICdwb2xpY2llcycsXG4gICAgICAnYWN0aW9uJyxcbiAgICBdKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHRocm93IGVycm9yIGlmIGNvbnRyb2xsZXIgaXMgbm90IGZvdW5kJywgKCkgPT4ge1xuICAgIGNvbnN0IHBvbGljeVV0aWxzID0gcmVxdWlyZSgndXRpbHMvcG9saWN5LnV0aWwnKTtcbiAgICBwb2xpY3lVdGlscy5nbG9iYWxQb2xpY3kgPSBqZXN0LmZuKCgpID0+ICdnbG9iYWxQb2xpY3knKTtcbiAgICBwb2xpY3lVdGlscy5nZXQgPSBqZXN0LmZuKCgpID0+ICdwb2xpY3lVdGlscycpO1xuXG4gICAgc2dBcHAuY29udHJvbGxlcnMgPSB7fTtcbiAgICBjb25zdCByb3V0ZSA9IHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgcGF0aDogJy9sb2dpbicsXG4gICAgICBoYW5kbGVyOiAnYXV0aC5sb2dpbicsXG4gICAgICBjb25maWc6IHtcbiAgICAgICAgcG9saWNpZXM6IFsnZ2xvYmFsOjp2YWxpZGF0b3InXSxcbiAgICAgICAgdmFsaWRhdG9yOiAndmFsaWRhdGVMb2dpblVzZXJJbnB1dCcsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgcm91dGVyQ2hlY2tlcihzZ0FwcCkocm91dGUpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgnZXJyb3InKTtcbiAgICB9XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCB0aHJvdyBlcnJvciBpZiBhY3Rpb24gY29udHJvbGxlciBpcyBub3QgZnVuY3Rpb24nLCAoKSA9PiB7XG4gICAgY29uc3QgcG9saWN5VXRpbHMgPSByZXF1aXJlKCd1dGlscy9wb2xpY3kudXRpbCcpO1xuICAgIHBvbGljeVV0aWxzLmdsb2JhbFBvbGljeSA9IGplc3QuZm4oKCkgPT4gJ2dsb2JhbFBvbGljeScpO1xuICAgIHBvbGljeVV0aWxzLmdldCA9IGplc3QuZm4oKCkgPT4gJ3BvbGljeVV0aWxzJyk7XG5cbiAgICBzZ0FwcC5jb250cm9sbGVycyA9IHsgYXV0aDogeyBsb2dpbjogJ2xvZ2luJywgaWRlbnRpdHk6ICdBdXRoJyB9IH07XG5cbiAgICBjb25zdCByb3V0ZSA9IHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgcGF0aDogJy9sb2dpbicsXG4gICAgICBoYW5kbGVyOiAnYXV0aC5sb2dpbicsXG4gICAgICBjb25maWc6IHtcbiAgICAgICAgcG9saWNpZXM6IFsnZ2xvYmFsOjp2YWxpZGF0b3InXSxcbiAgICAgICAgdmFsaWRhdG9yOiAndmFsaWRhdGVMb2dpblVzZXJJbnB1dCcsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgcm91dGVyQ2hlY2tlcihzZ0FwcCkocm91dGUpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBleHBlY3QoZXJyb3IubWVzc2FnZSkudG9CZSgnZXJyb3InKTtcbiAgICB9XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCB0aHJvdyBlcnJvciBpZiBjcmVhdGUgZW5kcG9pbnQgZmFpbCcsICgpID0+IHtcbiAgICBjb25zdCBwb2xpY3lVdGlscyA9IHJlcXVpcmUoJ3V0aWxzL3BvbGljeS51dGlsJyk7XG4gICAgcG9saWN5VXRpbHMuZ2xvYmFsUG9saWN5ID0gamVzdC5mbigoKSA9PiAnZ2xvYmFsUG9saWN5Jyk7XG4gICAgcG9saWN5VXRpbHMuZ2V0ID0gamVzdC5mbigoKSA9PiB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Vycm9yJyk7XG4gICAgfSk7XG5cbiAgICBjb25zdCByb3V0ZSA9IHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgcGF0aDogJy9sb2dpbicsXG4gICAgICBoYW5kbGVyOiAnYXV0aC5sb2dpbicsXG4gICAgICBjb25maWc6IHtcbiAgICAgICAgcG9saWNpZXM6ICdnbG9iYWw6OnZhbGlkYXRvcicsXG4gICAgICAgIHZhbGlkYXRvcjogJ3ZhbGlkYXRlTG9naW5Vc2VySW5wdXQnLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgIHJvdXRlckNoZWNrZXIoc2dBcHApKHJvdXRlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgZXhwZWN0KGVycm9yLm1lc3NhZ2UpLnRvQmUoJ2Vycm9yJyk7XG4gICAgfVxuICB9KTtcblxuICB0ZXN0KCdzaG91bGQgbm90IGdldCBwb2xpY3kgdXRpbCBpZiBjb25maWcgcG9saWNpZXMgaXMgdW5kZWZpbmVkICcsICgpID0+IHtcbiAgICBjb25zdCBwb2xpY3lVdGlscyA9IHJlcXVpcmUoJ3V0aWxzL3BvbGljeS51dGlsJyk7XG4gICAgcG9saWN5VXRpbHMuZ2xvYmFsUG9saWN5ID0gamVzdC5mbigoKSA9PiAnZ2xvYmFsUG9saWN5Jyk7XG4gICAgcG9saWN5VXRpbHMuZ2V0ID0gamVzdC5mbigoKSA9PiB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Vycm9yJyk7XG4gICAgfSk7XG5cbiAgICBjb25zdCByb3V0ZSA9IHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgcGF0aDogJy9sb2dpbicsXG4gICAgICBoYW5kbGVyOiAnYXV0aC5sb2dpbicsXG4gICAgICBjb25maWc6IHtcbiAgICAgICAgcG9saWNpZXM6IHVuZGVmaW5lZCxcbiAgICAgICAgdmFsaWRhdG9yOiAndmFsaWRhdGVMb2dpblVzZXJJbnB1dCcsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCByZXNwID0gcm91dGVyQ2hlY2tlcihzZ0FwcCkocm91dGUpO1xuICAgIGV4cGVjdChPYmplY3Qua2V5cyhyZXNwKSkudG9FcXVhbChbXG4gICAgICAnbWV0aG9kJyxcbiAgICAgICdlbmRwb2ludCcsXG4gICAgICAncG9saWNpZXMnLFxuICAgICAgJ2FjdGlvbicsXG4gICAgXSk7XG4gIH0pO1xufSk7XG4iXX0=