ce6c5ea07f4aced44c6e4b57e4e7de5a
const _ = require('lodash');

const logger = require('utils/logger.util');

const {
  createDatabaseManager
} = require('../database-manager');

describe('Create database manager', () => {
  const config = {
    database: {
      connections: {
        default: {
          connector: 'firebase',
          settings: {
            client: 'cloudfirestore',
            serviceAccount: process.env.SERVICE_ACCOUNT_PATH || '../firebase/serviceaccount.json'
          },
          options: {
            useNullAsDefault: true
          }
        }
      },
      defaultConnection: 'default'
    }
  };
  global.sgApp = {
    log: logger,
    config: { ...config,

      get(path, defaultValue) {
        return _.get(config, path, defaultValue);
      },

      set(path, val) {
        _.set(config, path, val);

        return this;
      },

      has(path) {
        return _.has(config, path);
      }

    }
  };
  const DatabaseManager = createDatabaseManager(sgApp);
  test('Should return initialize=flase', () => {
    expect(DatabaseManager.initialized).toBeFalsy();
  });
  describe('Database manager initialize', () => {
    test('Should return initialize=true', async () => {
      await DatabaseManager.initialize();
      expect(DatabaseManager.initialized).toBeTruthy();
    });
    test('Should return error if call initialize function again', async () => {
      await DatabaseManager.initialize().catch(e => {
        expect(e.message).toBe('Database manager already initialized');
      });
    });
  });
  describe('Query DB', () => {
    test('Should call query function', () => {
      DatabaseManager.connector.db.collection = jest.fn().mockImplementation(() => 'users');
      const resp = DatabaseManager.query('users');
      expect(DatabaseManager.connector.db.collection).toHaveBeenCalled();
      expect(resp).toBe('users');
    });
    test('Should call query function and throw error when entity is null', () => {
      expect(() => DatabaseManager.query()).toThrow();
    });
    test('Should call query function and throw error when model is null', () => {
      DatabaseManager.connector.db.collection = jest.fn().mockImplementation(() => '');
      expect(() => DatabaseManager.query('users')).toThrow();
    });
    test('Should call find function', () => {
      DatabaseManager.connector.find = jest.fn();
      DatabaseManager.find('users', {
        conditions: {
          email: 'test@gmail.com'
        }
      });
      expect(DatabaseManager.connector.find).toHaveBeenCalled();
    });
    test('Should call findOne function', () => {
      DatabaseManager.connector.findOne = jest.fn();
      DatabaseManager.findOne('users', '123456789');
      expect(DatabaseManager.connector.findOne).toHaveBeenCalled();
    });
    test('Should call create function', () => {
      DatabaseManager.connector.create = jest.fn();
      DatabaseManager.create('users', {
        name: 'ABC'
      }, '123456789');
      expect(DatabaseManager.connector.create).toHaveBeenCalled();
    });
    test('Should call update function', () => {
      DatabaseManager.connector.update = jest.fn();
      DatabaseManager.update('users', {
        name: 'DEF'
      }, '123456789');
      expect(DatabaseManager.connector.update).toHaveBeenCalled();
    });
    test('Should call delete function', () => {
      DatabaseManager.connector.delete = jest.fn();
      DatabaseManager.delete('users', '123456789');
      expect(DatabaseManager.connector.delete).toHaveBeenCalled();
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhdGFiYXNlLW1hbmFnZXIudGVzdC5qcyJdLCJuYW1lcyI6WyJfIiwicmVxdWlyZSIsImxvZ2dlciIsImNyZWF0ZURhdGFiYXNlTWFuYWdlciIsImRlc2NyaWJlIiwiY29uZmlnIiwiZGF0YWJhc2UiLCJjb25uZWN0aW9ucyIsImRlZmF1bHQiLCJjb25uZWN0b3IiLCJzZXR0aW5ncyIsImNsaWVudCIsInNlcnZpY2VBY2NvdW50IiwicHJvY2VzcyIsImVudiIsIlNFUlZJQ0VfQUNDT1VOVF9QQVRIIiwib3B0aW9ucyIsInVzZU51bGxBc0RlZmF1bHQiLCJkZWZhdWx0Q29ubmVjdGlvbiIsImdsb2JhbCIsInNnQXBwIiwibG9nIiwiZ2V0IiwicGF0aCIsImRlZmF1bHRWYWx1ZSIsInNldCIsInZhbCIsImhhcyIsIkRhdGFiYXNlTWFuYWdlciIsInRlc3QiLCJleHBlY3QiLCJpbml0aWFsaXplZCIsInRvQmVGYWxzeSIsImluaXRpYWxpemUiLCJ0b0JlVHJ1dGh5IiwiY2F0Y2giLCJlIiwibWVzc2FnZSIsInRvQmUiLCJkYiIsImNvbGxlY3Rpb24iLCJqZXN0IiwiZm4iLCJtb2NrSW1wbGVtZW50YXRpb24iLCJyZXNwIiwicXVlcnkiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwidG9UaHJvdyIsImZpbmQiLCJjb25kaXRpb25zIiwiZW1haWwiLCJmaW5kT25lIiwiY3JlYXRlIiwibmFtZSIsInVwZGF0ZSIsImRlbGV0ZSJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsQ0FBQyxHQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFqQjs7QUFDQSxNQUFNQyxNQUFNLEdBQUdELE9BQU8sQ0FBQyxtQkFBRCxDQUF0Qjs7QUFDQSxNQUFNO0FBQUVFLEVBQUFBO0FBQUYsSUFBNEJGLE9BQU8sQ0FBQyxxQkFBRCxDQUF6Qzs7QUFFQUcsUUFBUSxDQUFDLHlCQUFELEVBQTRCLE1BQU07QUFDeEMsUUFBTUMsTUFBTSxHQUFHO0FBQ2JDLElBQUFBLFFBQVEsRUFBRTtBQUNSQyxNQUFBQSxX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IF8gPSByZXF1aXJlKCdsb2Rhc2gnKTtcbmNvbnN0IGxvZ2dlciA9IHJlcXVpcmUoJ3V0aWxzL2xvZ2dlci51dGlsJyk7XG5jb25zdCB7IGNyZWF0ZURhdGFiYXNlTWFuYWdlciB9ID0gcmVxdWlyZSgnLi4vZGF0YWJhc2UtbWFuYWdlcicpO1xuXG5kZXNjcmliZSgnQ3JlYXRlIGRhdGFiYXNlIG1hbmFnZXInLCAoKSA9PiB7XG4gIGNvbnN0IGNvbmZpZyA9IHtcbiAgICBkYXRhYmFzZToge1xuICAgICAgY29ubmVjdGlvbnM6IHtcbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIGNvbm5lY3RvcjogJ2ZpcmViYXNlJyxcbiAgICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgY2xpZW50OiAnY2xvdWRmaXJlc3RvcmUnLFxuICAgICAgICAgICAgc2VydmljZUFjY291bnQ6XG4gICAgICAgICAgICAgIHByb2Nlc3MuZW52LlNFUlZJQ0VfQUNDT1VOVF9QQVRIIHx8XG4gICAgICAgICAgICAgICcuLi9maXJlYmFzZS9zZXJ2aWNlYWNjb3VudC5qc29uJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIHVzZU51bGxBc0RlZmF1bHQ6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBkZWZhdWx0Q29ubmVjdGlvbjogJ2RlZmF1bHQnLFxuICAgIH0sXG4gIH07XG4gIGdsb2JhbC5zZ0FwcCA9IHtcbiAgICBsb2c6IGxvZ2dlcixcbiAgICBjb25maWc6IHtcbiAgICAgIC4uLmNvbmZpZyxcbiAgICAgIGdldChwYXRoLCBkZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIF8uZ2V0KGNvbmZpZywgcGF0aCwgZGVmYXVsdFZhbHVlKTtcbiAgICAgIH0sXG5cbiAgICAgIHNldChwYXRoLCB2YWwpIHtcbiAgICAgICAgXy5zZXQoY29uZmlnLCBwYXRoLCB2YWwpO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG5cbiAgICAgIGhhcyhwYXRoKSB7XG4gICAgICAgIHJldHVybiBfLmhhcyhjb25maWcsIHBhdGgpO1xuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0IERhdGFiYXNlTWFuYWdlciA9IGNyZWF0ZURhdGFiYXNlTWFuYWdlcihzZ0FwcCk7XG5cbiAgdGVzdCgnU2hvdWxkIHJldHVybiBpbml0aWFsaXplPWZsYXNlJywgKCkgPT4ge1xuICAgIGV4cGVjdChEYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZWQpLnRvQmVGYWxzeSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGF0YWJhc2UgbWFuYWdlciBpbml0aWFsaXplJywgKCkgPT4ge1xuICAgIHRlc3QoJ1Nob3VsZCByZXR1cm4gaW5pdGlhbGl6ZT10cnVlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgRGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKTtcbiAgICAgIGV4cGVjdChEYXRhYmFzZU1hbmFnZXIuaW5pdGlhbGl6ZWQpLnRvQmVUcnV0aHkoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ1Nob3VsZCByZXR1cm4gZXJyb3IgaWYgY2FsbCBpbml0aWFsaXplIGZ1bmN0aW9uIGFnYWluJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgRGF0YWJhc2VNYW5hZ2VyLmluaXRpYWxpemUoKS5jYXRjaCgoZSkgPT4ge1xuICAgICAgICBleHBlY3QoZS5tZXNzYWdlKS50b0JlKCdEYXRhYmFzZSBtYW5hZ2VyIGFscmVhZHkgaW5pdGlhbGl6ZWQnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUXVlcnkgREInLCAoKSA9PiB7XG4gICAgdGVzdCgnU2hvdWxkIGNhbGwgcXVlcnkgZnVuY3Rpb24nLCAoKSA9PiB7XG4gICAgICBEYXRhYmFzZU1hbmFnZXIuY29ubmVjdG9yLmRiLmNvbGxlY3Rpb24gPSBqZXN0XG4gICAgICAgIC5mbigpXG4gICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gJ3VzZXJzJyk7XG4gICAgICBjb25zdCByZXNwID0gRGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCd1c2VycycpO1xuICAgICAgZXhwZWN0KERhdGFiYXNlTWFuYWdlci5jb25uZWN0b3IuZGIuY29sbGVjdGlvbikudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KHJlc3ApLnRvQmUoJ3VzZXJzJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdTaG91bGQgY2FsbCBxdWVyeSBmdW5jdGlvbiBhbmQgdGhyb3cgZXJyb3Igd2hlbiBlbnRpdHkgaXMgbnVsbCcsICgpID0+IHtcbiAgICAgIGV4cGVjdCgoKSA9PiBEYXRhYmFzZU1hbmFnZXIucXVlcnkoKSkudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnU2hvdWxkIGNhbGwgcXVlcnkgZnVuY3Rpb24gYW5kIHRocm93IGVycm9yIHdoZW4gbW9kZWwgaXMgbnVsbCcsICgpID0+IHtcbiAgICAgIERhdGFiYXNlTWFuYWdlci5jb25uZWN0b3IuZGIuY29sbGVjdGlvbiA9IGplc3RcbiAgICAgICAgLmZuKClcbiAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAnJyk7XG4gICAgICBleHBlY3QoKCkgPT4gRGF0YWJhc2VNYW5hZ2VyLnF1ZXJ5KCd1c2VycycpKS50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdTaG91bGQgY2FsbCBmaW5kIGZ1bmN0aW9uJywgKCkgPT4ge1xuICAgICAgRGF0YWJhc2VNYW5hZ2VyLmNvbm5lY3Rvci5maW5kID0gamVzdC5mbigpO1xuICAgICAgRGF0YWJhc2VNYW5hZ2VyLmZpbmQoJ3VzZXJzJywge1xuICAgICAgICBjb25kaXRpb25zOiB7IGVtYWlsOiAndGVzdEBnbWFpbC5jb20nIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChEYXRhYmFzZU1hbmFnZXIuY29ubmVjdG9yLmZpbmQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ1Nob3VsZCBjYWxsIGZpbmRPbmUgZnVuY3Rpb24nLCAoKSA9PiB7XG4gICAgICBEYXRhYmFzZU1hbmFnZXIuY29ubmVjdG9yLmZpbmRPbmUgPSBqZXN0LmZuKCk7XG4gICAgICBEYXRhYmFzZU1hbmFnZXIuZmluZE9uZSgndXNlcnMnLCAnMTIzNDU2Nzg5Jyk7XG4gICAgICBleHBlY3QoRGF0YWJhc2VNYW5hZ2VyLmNvbm5lY3Rvci5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdTaG91bGQgY2FsbCBjcmVhdGUgZnVuY3Rpb24nLCAoKSA9PiB7XG4gICAgICBEYXRhYmFzZU1hbmFnZXIuY29ubmVjdG9yLmNyZWF0ZSA9IGplc3QuZm4oKTtcbiAgICAgIERhdGFiYXNlTWFuYWdlci5jcmVhdGUoJ3VzZXJzJywgeyBuYW1lOiAnQUJDJyB9LCAnMTIzNDU2Nzg5Jyk7XG4gICAgICBleHBlY3QoRGF0YWJhc2VNYW5hZ2VyLmNvbm5lY3Rvci5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ1Nob3VsZCBjYWxsIHVwZGF0ZSBmdW5jdGlvbicsICgpID0+IHtcbiAgICAgIERhdGFiYXNlTWFuYWdlci5jb25uZWN0b3IudXBkYXRlID0gamVzdC5mbigpO1xuICAgICAgRGF0YWJhc2VNYW5hZ2VyLnVwZGF0ZSgndXNlcnMnLCB7IG5hbWU6ICdERUYnIH0sICcxMjM0NTY3ODknKTtcbiAgICAgIGV4cGVjdChEYXRhYmFzZU1hbmFnZXIuY29ubmVjdG9yLnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnU2hvdWxkIGNhbGwgZGVsZXRlIGZ1bmN0aW9uJywgKCkgPT4ge1xuICAgICAgRGF0YWJhc2VNYW5hZ2VyLmNvbm5lY3Rvci5kZWxldGUgPSBqZXN0LmZuKCk7XG4gICAgICBEYXRhYmFzZU1hbmFnZXIuZGVsZXRlKCd1c2VycycsICcxMjM0NTY3ODknKTtcbiAgICAgIGV4cGVjdChEYXRhYmFzZU1hbmFnZXIuY29ubmVjdG9yLmRlbGV0ZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19