f6a0369830dca565792b04f99689ac0a
_getJestObj().mock('../router/utils/routerChecker');

function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");

  _getJestObj = () => jest;

  return jest;
}

const composeEndpoint = require('../router/utils/composeEndpoint');

const logger = require('utils/logger.util');

describe('Compose endpoint', () => {
  global.sgApp = {
    log: logger,
    stopWithError: jest.fn(),
    controllers: {
      auth: {
        login: jest.fn(),
        identity: 'Auth'
      }
    },
    api: {
      auth: {
        controllers: {
          auth: {
            identity: 'Auth',
            log: {}
          }
        },
        config: {
          routes: [{
            method: 'POST',
            path: '/login',
            handler: 'auth.login',
            config: {
              policies: ['global::validator'],
              validator: 'validateLoginUserInput'
            }
          }]
        }
      }
    }
  }; // afterEach(() => {
  //   jest.resetModules();
  //   jest.restoreAllMocks();
  // });

  test('should compose endpoint', () => {
    const createRouteChecker = require('../router/utils/routerChecker');

    createRouteChecker.mockReturnValueOnce(jest.fn(() => ({
      method: 'post',
      endpoint: '/login',
      policies: jest.fn((req, res, next) => next()),
      action: jest.fn()
    })));
    const route = {
      method: 'POST',
      path: '/login',
      handler: 'auth.login',
      config: {
        policies: ['global::validator'],
        validator: 'validateLoginUserInput'
      }
    };
    const router = {
      post: jest.fn()
    };
    composeEndpoint({
      log: logger
    })(route, {
      router
    });
    expect(router.post).toHaveBeenCalledTimes(1);
  });
  test('should return undefined when method is empty', () => {
    const route = {
      path: '/login',
      handler: 'auth.login',
      config: {
        policies: ['global::validator'],
        validator: 'validateLoginUserInput'
      }
    };
    const router = {
      post: jest.fn()
    };
    expect(composeEndpoint({
      log: logger
    })(route, {
      router
    })).toBeUndefined();
  });
  test('should return undefined when path is empty', () => {
    const route = {
      method: 'POST',
      handler: 'auth.login',
      config: {
        policies: ['global::validator'],
        validator: 'validateLoginUserInput'
      }
    };
    const router = {
      post: jest.fn()
    };
    expect(composeEndpoint({
      log: logger
    })(route, {
      router
    })).toBeUndefined();
  });
  test('should return warn log when action is undefined', () => {
    const createRouteChecker = require('../router/utils/routerChecker');

    createRouteChecker.mockReturnValueOnce(jest.fn(() => ({
      method: 'post',
      endpoint: '/login',
      policies: jest.fn((req, res, next) => next()),
      action: undefined
    })));
    const route = {
      method: 'POST',
      path: '/login',
      handler: 'auth.login',
      config: {
        policies: ['global::validator'],
        validator: 'validateLoginUserInput'
      }
    };
    const router = {
      post: jest.fn()
    };
    expect(composeEndpoint({
      log: logger
    })(route, {
      router
    })).toBeUndefined();
  });
  test('should return warn log when action is not function', () => {
    const createRouteChecker = require('../router/utils/routerChecker');

    createRouteChecker.mockReturnValueOnce(jest.fn(() => ({
      method: 'post',
      endpoint: '/login',
      policies: jest.fn((req, res, next) => next()),
      action: 'action'
    })));
    const route = {
      method: 'POST',
      path: '/login',
      handler: 'auth.login',
      config: {
        policies: ['global::validator'],
        validator: 'validateLoginUserInput'
      }
    };
    const router = {
      post: jest.fn()
    };
    expect(composeEndpoint({
      log: logger
    })(route, {
      router
    })).toBeUndefined();
  });
  test('should call router and response json data', () => {
    const checker = {
      method: 'post',
      endpoint: '/login',
      policies: jest.fn((req, res, next) => next()),
      action: jest.fn()
    };

    const createRouteChecker = require('../router/utils/routerChecker');

    createRouteChecker.mockReturnValueOnce(jest.fn(() => checker));
    const route = {
      method: 'POST',
      path: '/login',
      handler: 'auth.login',
      config: {
        policies: ['global::validator'],
        validator: 'validateLoginUserInput'
      }
    };

    const express = require('express');

    const mRouter = {
      post: jest.fn()
    };
    jest.spyOn(express, 'Router').mockImplementationOnce(() => mRouter);
    const req = {};
    const res = {
      json: jest.fn()
    };
    const next = jest.fn();
    mRouter.post.mockImplementation((path, policies, callback) => {
      if (path === '/login') {
        callback(req, res, next);
      }
    });
    composeEndpoint({
      log: logger
    })(route, {
      router: mRouter
    });
    expect(checker.action).toHaveBeenCalledTimes(1);
  });
  test('should call router and response with headersSent', () => {
    const checker = {
      method: 'post',
      endpoint: '/login',
      policies: jest.fn((req, res, next) => next()),
      action: jest.fn(() => ({
        headersSent: true
      }))
    };

    const createRouteChecker = require('../router/utils/routerChecker');

    createRouteChecker.mockReturnValueOnce(jest.fn(() => checker));
    const route = {
      method: 'POST',
      path: '/login',
      handler: 'auth.login',
      config: {
        policies: ['global::validator'],
        validator: 'validateLoginUserInput'
      }
    };

    const express = require('express');

    const mRouter = {
      post: jest.fn()
    };
    jest.spyOn(express, 'Router').mockImplementationOnce(() => mRouter);
    const req = {};
    const res = {
      json: jest.fn()
    };
    const next = jest.fn();
    mRouter.post.mockImplementation((path, policies, callback) => {
      if (path === '/login') {
        callback(req, res, next);
      }
    });
    composeEndpoint({
      log: logger
    })(route, {
      router: mRouter
    });
    expect(checker.action).toHaveBeenCalledTimes(1);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdXRlci51dGlscy5jb21wb3NlRW5kcG9pbnQudGVzdC5qcyJdLCJuYW1lcyI6WyJtb2NrIiwiY29tcG9zZUVuZHBvaW50IiwicmVxdWlyZSIsImxvZ2dlciIsImRlc2NyaWJlIiwiZ2xvYmFsIiwic2dBcHAiLCJsb2ciLCJzdG9wV2l0aEVycm9yIiwiamVzdCIsImZuIiwiY29udHJvbGxlcnMiLCJhdXRoIiwibG9naW4iLCJpZGVudGl0eSIsImFwaSIsImNvbmZpZyIsInJvdXRlcyIsIm1ldGhvZCIsInBhdGgiLCJoYW5kbGVyIiwicG9saWNpZXMiLCJ2YWxpZGF0b3IiLCJ0ZXN0IiwiY3JlYXRlUm91dGVDaGVja2VyIiwibW9ja1JldHVyblZhbHVlT25jZSIsImVuZHBvaW50IiwicmVxIiwicmVzIiwibmV4dCIsImFjdGlvbiIsInJvdXRlIiwicm91dGVyIiwicG9zdCIsImV4cGVjdCIsInRvSGF2ZUJlZW5DYWxsZWRUaW1lcyIsInRvQmVVbmRlZmluZWQiLCJ1bmRlZmluZWQiLCJjaGVja2VyIiwiZXhwcmVzcyIsIm1Sb3V0ZXIiLCJzcHlPbiIsIm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UiLCJqc29uIiwibW9ja0ltcGxlbWVudGF0aW9uIiwiY2FsbGJhY2siLCJoZWFkZXJzU2VudCJdLCJtYXBwaW5ncyI6IkFBR0EsY0FBS0EsSUFBTCxDQUFVLCtCQUFWOzs7Ozs7Ozs7Ozs7QUFIQSxNQUFNQyxlQUFlLEdBQUdDLE9BQU8sQ0FBQyxpQ0FBRCxDQUEvQjs7QUFDQSxNQUFNQyxNQUFNLEdBQUdELE9BQU8sQ0FBQyxtQkFBRCxDQUF0Qjs7QUFJQUUsUUFBUSxDQUFDLGtCQUFELEVBQXFCLE1BQU07QUFDakNDLEVBQUFBLE1BQU0sQ0FBQ0MsS0FBUCxHQUFlO0FBQ2JDLElBQUFBLEdBQUcsRUFBRUosTUFEUTtBQUViSyxJQUFBQSxhQUFhLEVBQUVDLElBQUksQ0FBQ0MsRUFBTCxFQUZGO0FBR2JDLElBQUFBLFdBQVcsRUFBRTtBQUFFQyxNQUFBQSxJQUFJ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RDtBQUNGLEtBSkQ7QUFNQTVCLElBQUFBLGVBQWUsQ0FBQztBQUFFTSxNQUFBQSxHQUFHLEVBQUVKO0FBQVAsS0FBRCxDQUFmLENBQWlDNEIsS0FBakMsRUFBd0M7QUFBRUMsTUFBQUEsTUFBTSxFQUFFUTtBQUFWLEtBQXhDO0FBQ0FOLElBQUFBLE1BQU0sQ0FBQ0ksT0FBTyxDQUFDUixNQUFULENBQU4sQ0FBdUJLLHFCQUF2QixDQUE2QyxDQUE3QztBQUNELEdBbENHLENBQUo7QUFtQ0QsQ0FqT08sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNvbXBvc2VFbmRwb2ludCA9IHJlcXVpcmUoJy4uL3JvdXRlci91dGlscy9jb21wb3NlRW5kcG9pbnQnKTtcbmNvbnN0IGxvZ2dlciA9IHJlcXVpcmUoJ3V0aWxzL2xvZ2dlci51dGlsJyk7XG5cbmplc3QubW9jaygnLi4vcm91dGVyL3V0aWxzL3JvdXRlckNoZWNrZXInKTtcblxuZGVzY3JpYmUoJ0NvbXBvc2UgZW5kcG9pbnQnLCAoKSA9PiB7XG4gIGdsb2JhbC5zZ0FwcCA9IHtcbiAgICBsb2c6IGxvZ2dlcixcbiAgICBzdG9wV2l0aEVycm9yOiBqZXN0LmZuKCksXG4gICAgY29udHJvbGxlcnM6IHsgYXV0aDogeyBsb2dpbjogamVzdC5mbigpLCBpZGVudGl0eTogJ0F1dGgnIH0gfSxcbiAgICBhcGk6IHtcbiAgICAgIGF1dGg6IHtcbiAgICAgICAgY29udHJvbGxlcnM6IHtcbiAgICAgICAgICBhdXRoOiB7XG4gICAgICAgICAgICBpZGVudGl0eTogJ0F1dGgnLFxuICAgICAgICAgICAgbG9nOiB7fSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICByb3V0ZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgIHBhdGg6ICcvbG9naW4nLFxuICAgICAgICAgICAgICBoYW5kbGVyOiAnYXV0aC5sb2dpbicsXG4gICAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICAgIHBvbGljaWVzOiBbJ2dsb2JhbDo6dmFsaWRhdG9yJ10sXG4gICAgICAgICAgICAgICAgdmFsaWRhdG9yOiAndmFsaWRhdGVMb2dpblVzZXJJbnB1dCcsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH07XG5cbiAgLy8gYWZ0ZXJFYWNoKCgpID0+IHtcbiAgLy8gICBqZXN0LnJlc2V0TW9kdWxlcygpO1xuICAvLyAgIGplc3QucmVzdG9yZUFsbE1vY2tzKCk7XG4gIC8vIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCBjb21wb3NlIGVuZHBvaW50JywgKCkgPT4ge1xuICAgIGNvbnN0IGNyZWF0ZVJvdXRlQ2hlY2tlciA9IHJlcXVpcmUoJy4uL3JvdXRlci91dGlscy9yb3V0ZXJDaGVja2VyJyk7XG4gICAgY3JlYXRlUm91dGVDaGVja2VyLm1vY2tSZXR1cm5WYWx1ZU9uY2UoXG4gICAgICBqZXN0LmZuKCgpID0+ICh7XG4gICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICBlbmRwb2ludDogJy9sb2dpbicsXG4gICAgICAgIHBvbGljaWVzOiBqZXN0LmZuKChyZXEsIHJlcywgbmV4dCkgPT4gbmV4dCgpKSxcbiAgICAgICAgYWN0aW9uOiBqZXN0LmZuKCksXG4gICAgICB9KSlcbiAgICApO1xuXG4gICAgY29uc3Qgcm91dGUgPSB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIHBhdGg6ICcvbG9naW4nLFxuICAgICAgaGFuZGxlcjogJ2F1dGgubG9naW4nLFxuICAgICAgY29uZmlnOiB7XG4gICAgICAgIHBvbGljaWVzOiBbJ2dsb2JhbDo6dmFsaWRhdG9yJ10sXG4gICAgICAgIHZhbGlkYXRvcjogJ3ZhbGlkYXRlTG9naW5Vc2VySW5wdXQnLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3Qgcm91dGVyID0ge1xuICAgICAgcG9zdDogamVzdC5mbigpLFxuICAgIH07XG5cbiAgICBjb21wb3NlRW5kcG9pbnQoeyBsb2c6IGxvZ2dlciB9KShyb3V0ZSwgeyByb3V0ZXIgfSk7XG4gICAgZXhwZWN0KHJvdXRlci5wb3N0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCByZXR1cm4gdW5kZWZpbmVkIHdoZW4gbWV0aG9kIGlzIGVtcHR5JywgKCkgPT4ge1xuICAgIGNvbnN0IHJvdXRlID0ge1xuICAgICAgcGF0aDogJy9sb2dpbicsXG4gICAgICBoYW5kbGVyOiAnYXV0aC5sb2dpbicsXG4gICAgICBjb25maWc6IHtcbiAgICAgICAgcG9saWNpZXM6IFsnZ2xvYmFsOjp2YWxpZGF0b3InXSxcbiAgICAgICAgdmFsaWRhdG9yOiAndmFsaWRhdGVMb2dpblVzZXJJbnB1dCcsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCByb3V0ZXIgPSB7XG4gICAgICBwb3N0OiBqZXN0LmZuKCksXG4gICAgfTtcblxuICAgIGV4cGVjdChjb21wb3NlRW5kcG9pbnQoeyBsb2c6IGxvZ2dlciB9KShyb3V0ZSwgeyByb3V0ZXIgfSkpLnRvQmVVbmRlZmluZWQoKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHJldHVybiB1bmRlZmluZWQgd2hlbiBwYXRoIGlzIGVtcHR5JywgKCkgPT4ge1xuICAgIGNvbnN0IHJvdXRlID0ge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoYW5kbGVyOiAnYXV0aC5sb2dpbicsXG4gICAgICBjb25maWc6IHtcbiAgICAgICAgcG9saWNpZXM6IFsnZ2xvYmFsOjp2YWxpZGF0b3InXSxcbiAgICAgICAgdmFsaWRhdG9yOiAndmFsaWRhdGVMb2dpblVzZXJJbnB1dCcsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCByb3V0ZXIgPSB7XG4gICAgICBwb3N0OiBqZXN0LmZuKCksXG4gICAgfTtcblxuICAgIGV4cGVjdChjb21wb3NlRW5kcG9pbnQoeyBsb2c6IGxvZ2dlciB9KShyb3V0ZSwgeyByb3V0ZXIgfSkpLnRvQmVVbmRlZmluZWQoKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHJldHVybiB3YXJuIGxvZyB3aGVuIGFjdGlvbiBpcyB1bmRlZmluZWQnLCAoKSA9PiB7XG4gICAgY29uc3QgY3JlYXRlUm91dGVDaGVja2VyID0gcmVxdWlyZSgnLi4vcm91dGVyL3V0aWxzL3JvdXRlckNoZWNrZXInKTtcbiAgICBjcmVhdGVSb3V0ZUNoZWNrZXIubW9ja1JldHVyblZhbHVlT25jZShcbiAgICAgIGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIGVuZHBvaW50OiAnL2xvZ2luJyxcbiAgICAgICAgcG9saWNpZXM6IGplc3QuZm4oKHJlcSwgcmVzLCBuZXh0KSA9PiBuZXh0KCkpLFxuICAgICAgICBhY3Rpb246IHVuZGVmaW5lZCxcbiAgICAgIH0pKVxuICAgICk7XG5cbiAgICBjb25zdCByb3V0ZSA9IHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgcGF0aDogJy9sb2dpbicsXG4gICAgICBoYW5kbGVyOiAnYXV0aC5sb2dpbicsXG4gICAgICBjb25maWc6IHtcbiAgICAgICAgcG9saWNpZXM6IFsnZ2xvYmFsOjp2YWxpZGF0b3InXSxcbiAgICAgICAgdmFsaWRhdG9yOiAndmFsaWRhdGVMb2dpblVzZXJJbnB1dCcsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCByb3V0ZXIgPSB7XG4gICAgICBwb3N0OiBqZXN0LmZuKCksXG4gICAgfTtcblxuICAgIGV4cGVjdChjb21wb3NlRW5kcG9pbnQoeyBsb2c6IGxvZ2dlciB9KShyb3V0ZSwgeyByb3V0ZXIgfSkpLnRvQmVVbmRlZmluZWQoKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIHJldHVybiB3YXJuIGxvZyB3aGVuIGFjdGlvbiBpcyBub3QgZnVuY3Rpb24nLCAoKSA9PiB7XG4gICAgY29uc3QgY3JlYXRlUm91dGVDaGVja2VyID0gcmVxdWlyZSgnLi4vcm91dGVyL3V0aWxzL3JvdXRlckNoZWNrZXInKTtcbiAgICBjcmVhdGVSb3V0ZUNoZWNrZXIubW9ja1JldHVyblZhbHVlT25jZShcbiAgICAgIGplc3QuZm4oKCkgPT4gKHtcbiAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgIGVuZHBvaW50OiAnL2xvZ2luJyxcbiAgICAgICAgcG9saWNpZXM6IGplc3QuZm4oKHJlcSwgcmVzLCBuZXh0KSA9PiBuZXh0KCkpLFxuICAgICAgICBhY3Rpb246ICdhY3Rpb24nLFxuICAgICAgfSkpXG4gICAgKTtcblxuICAgIGNvbnN0IHJvdXRlID0ge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBwYXRoOiAnL2xvZ2luJyxcbiAgICAgIGhhbmRsZXI6ICdhdXRoLmxvZ2luJyxcbiAgICAgIGNvbmZpZzoge1xuICAgICAgICBwb2xpY2llczogWydnbG9iYWw6OnZhbGlkYXRvciddLFxuICAgICAgICB2YWxpZGF0b3I6ICd2YWxpZGF0ZUxvZ2luVXNlcklucHV0JyxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IHJvdXRlciA9IHtcbiAgICAgIHBvc3Q6IGplc3QuZm4oKSxcbiAgICB9O1xuXG4gICAgZXhwZWN0KGNvbXBvc2VFbmRwb2ludCh7IGxvZzogbG9nZ2VyIH0pKHJvdXRlLCB7IHJvdXRlciB9KSkudG9CZVVuZGVmaW5lZCgpO1xuICB9KTtcblxuICB0ZXN0KCdzaG91bGQgY2FsbCByb3V0ZXIgYW5kIHJlc3BvbnNlIGpzb24gZGF0YScsICgpID0+IHtcbiAgICBjb25zdCBjaGVja2VyID0ge1xuICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICBlbmRwb2ludDogJy9sb2dpbicsXG4gICAgICBwb2xpY2llczogamVzdC5mbigocmVxLCByZXMsIG5leHQpID0+IG5leHQoKSksXG4gICAgICBhY3Rpb246IGplc3QuZm4oKSxcbiAgICB9O1xuICAgIGNvbnN0IGNyZWF0ZVJvdXRlQ2hlY2tlciA9IHJlcXVpcmUoJy4uL3JvdXRlci91dGlscy9yb3V0ZXJDaGVja2VyJyk7XG4gICAgY3JlYXRlUm91dGVDaGVja2VyLm1vY2tSZXR1cm5WYWx1ZU9uY2UoamVzdC5mbigoKSA9PiBjaGVja2VyKSk7XG5cbiAgICBjb25zdCByb3V0ZSA9IHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgcGF0aDogJy9sb2dpbicsXG4gICAgICBoYW5kbGVyOiAnYXV0aC5sb2dpbicsXG4gICAgICBjb25maWc6IHtcbiAgICAgICAgcG9saWNpZXM6IFsnZ2xvYmFsOjp2YWxpZGF0b3InXSxcbiAgICAgICAgdmFsaWRhdG9yOiAndmFsaWRhdGVMb2dpblVzZXJJbnB1dCcsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuICAgIGNvbnN0IG1Sb3V0ZXIgPSB7IHBvc3Q6IGplc3QuZm4oKSB9O1xuICAgIGplc3Quc3B5T24oZXhwcmVzcywgJ1JvdXRlcicpLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4gbVJvdXRlcik7XG4gICAgY29uc3QgcmVxID0ge307XG4gICAgY29uc3QgcmVzID0geyBqc29uOiBqZXN0LmZuKCkgfTtcbiAgICBjb25zdCBuZXh0ID0gamVzdC5mbigpO1xuICAgIG1Sb3V0ZXIucG9zdC5tb2NrSW1wbGVtZW50YXRpb24oKHBhdGgsIHBvbGljaWVzLCBjYWxsYmFjaykgPT4ge1xuICAgICAgaWYgKHBhdGggPT09ICcvbG9naW4nKSB7XG4gICAgICAgIGNhbGxiYWNrKHJlcSwgcmVzLCBuZXh0KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbXBvc2VFbmRwb2ludCh7IGxvZzogbG9nZ2VyIH0pKHJvdXRlLCB7IHJvdXRlcjogbVJvdXRlciB9KTtcbiAgICBleHBlY3QoY2hlY2tlci5hY3Rpb24pLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIGNhbGwgcm91dGVyIGFuZCByZXNwb25zZSB3aXRoIGhlYWRlcnNTZW50JywgKCkgPT4ge1xuICAgIGNvbnN0IGNoZWNrZXIgPSB7XG4gICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgIGVuZHBvaW50OiAnL2xvZ2luJyxcbiAgICAgIHBvbGljaWVzOiBqZXN0LmZuKChyZXEsIHJlcywgbmV4dCkgPT4gbmV4dCgpKSxcbiAgICAgIGFjdGlvbjogamVzdC5mbigoKSA9PiAoeyBoZWFkZXJzU2VudDogdHJ1ZSB9KSksXG4gICAgfTtcbiAgICBjb25zdCBjcmVhdGVSb3V0ZUNoZWNrZXIgPSByZXF1aXJlKCcuLi9yb3V0ZXIvdXRpbHMvcm91dGVyQ2hlY2tlcicpO1xuICAgIGNyZWF0ZVJvdXRlQ2hlY2tlci5tb2NrUmV0dXJuVmFsdWVPbmNlKGplc3QuZm4oKCkgPT4gY2hlY2tlcikpO1xuXG4gICAgY29uc3Qgcm91dGUgPSB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIHBhdGg6ICcvbG9naW4nLFxuICAgICAgaGFuZGxlcjogJ2F1dGgubG9naW4nLFxuICAgICAgY29uZmlnOiB7XG4gICAgICAgIHBvbGljaWVzOiBbJ2dsb2JhbDo6dmFsaWRhdG9yJ10sXG4gICAgICAgIHZhbGlkYXRvcjogJ3ZhbGlkYXRlTG9naW5Vc2VySW5wdXQnLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbiAgICBjb25zdCBtUm91dGVyID0geyBwb3N0OiBqZXN0LmZuKCkgfTtcbiAgICBqZXN0LnNweU9uKGV4cHJlc3MsICdSb3V0ZXInKS5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+IG1Sb3V0ZXIpO1xuICAgIGNvbnN0IHJlcSA9IHt9O1xuICAgIGNvbnN0IHJlcyA9IHsganNvbjogamVzdC5mbigpIH07XG4gICAgY29uc3QgbmV4dCA9IGplc3QuZm4oKTtcbiAgICBtUm91dGVyLnBvc3QubW9ja0ltcGxlbWVudGF0aW9uKChwYXRoLCBwb2xpY2llcywgY2FsbGJhY2spID0+IHtcbiAgICAgIGlmIChwYXRoID09PSAnL2xvZ2luJykge1xuICAgICAgICBjYWxsYmFjayhyZXEsIHJlcywgbmV4dCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb21wb3NlRW5kcG9pbnQoeyBsb2c6IGxvZ2dlciB9KShyb3V0ZSwgeyByb3V0ZXI6IG1Sb3V0ZXIgfSk7XG4gICAgZXhwZWN0KGNoZWNrZXIuYWN0aW9uKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gIH0pO1xufSk7XG4iXX0=