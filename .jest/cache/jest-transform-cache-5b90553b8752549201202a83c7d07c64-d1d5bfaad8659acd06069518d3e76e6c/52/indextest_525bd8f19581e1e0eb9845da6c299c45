96ab870b85ca593ebed5183dfc53b048
const _ = require('lodash');

const logger = require('../../../../utils/logger.util');

const firebaseConnector = require('../index');

describe('Create database manager', () => {
  const config = {
    database: {
      connections: {
        default: {
          connector: 'firebase',
          settings: {
            client: 'cloudfirestore',
            serviceAccount: process.env.SERVICE_ACCOUNT_PATH || '../firebase/serviceaccount.json'
          },
          options: {
            useNullAsDefault: true
          }
        }
      },
      defaultConnection: 'default'
    }
  };
  global.sgApp = {
    log: logger,
    config: { ...config,

      get(path, defaultValue) {
        return _.get(config, path, defaultValue);
      },

      set(path, val) {
        _.set(config, path, val);

        return this;
      },

      has(path) {
        return _.has(config, path);
      }

    }
  };
  const connector = firebaseConnector();
  test('Should initialize', () => {
    connector.initialize();
    expect(connector.db).not.toBeNull();
  });
  test('Should find item', async () => {
    connector.db = {
      collection: jest.fn().mockImplementation(collection => ({
        where: jest.fn().mockImplementation((k, o, v) => ({
          orderBy: jest.fn().mockImplementation((k, v) => ({
            limit: jest.fn().mockImplementation(v => ({
              get: jest.fn().mockResolvedValue([{
                data() {
                  return {
                    id: '1234',
                    name: 'ABCD',
                    kind: 'find'
                  };
                }

              }])
            }))
          }))
        }))
      }))
    };
    const resp = await connector.find('users', {
      conditions: {
        email: 'test@gmail.com'
      },
      order: {
        k: 'name',
        v: 'asc'
      },
      limit: 1
    });
    expect(resp).toEqual([{
      id: '1234',
      name: 'ABCD',
      kind: 'find'
    }]);
  });
  test('Should find item with operation', async () => {
    connector.db = {
      collection: jest.fn().mockImplementation(collection => ({
        where: jest.fn().mockImplementation((k, o, v) => ({
          orderBy: jest.fn().mockImplementation((k, v) => ({
            limit: jest.fn().mockImplementation(v => ({
              get: jest.fn().mockResolvedValue([{
                data() {
                  return {
                    id: '1234',
                    name: 'ABCD',
                    kind: 'find'
                  };
                }

              }])
            }))
          }))
        }))
      }))
    };
    const resp = await connector.find('users', {
      conditions: {
        email: 'test@gmail.com'
      },
      order: {
        k: 'name',
        v: 'asc'
      },
      operators: {
        email: '=='
      },
      limit: 1
    });
    expect(resp).toEqual([{
      id: '1234',
      name: 'ABCD',
      kind: 'find'
    }]);
  });
  test('Should find item with query is empty', async () => {
    connector.db = {
      collection: jest.fn().mockImplementation(collection => ({
        get: jest.fn().mockResolvedValue([{
          data() {
            return {
              id: '1234',
              name: 'ABCD',
              kind: 'find'
            };
          }

        }])
      }))
    };
    const resp = await connector.find('users');
    expect(resp).toEqual([{
      id: '1234',
      name: 'ABCD',
      kind: 'find'
    }]);
  });
  test('Should findOne item', async () => {
    connector.db = {
      collection: jest.fn().mockImplementation(collection => ({
        doc: jest.fn().mockImplementation(id => ({
          get: jest.fn().mockResolvedValue({
            data() {
              return {
                id: '1234',
                name: 'ABCD',
                kind: 'findOne'
              };
            }

          })
        }))
      }))
    };
    const resp = await connector.findOne('users', '1234');
    expect(resp).toEqual({
      id: '1234',
      name: 'ABCD',
      kind: 'findOne'
    });
  });
  test('Should create item', async () => {
    connector.db = {
      collection: jest.fn().mockImplementation(collection => ({
        doc: jest.fn().mockImplementation(id => ({
          set: jest.fn().mockResolvedValue({
            id: '1234',
            name: 'ABCD',
            kind: 'create'
          })
        }))
      }))
    };
    const resp = await connector.create('users', {
      name: 'ABCD'
    }, '1234');
    expect(resp).toEqual({
      id: '1234',
      name: 'ABCD',
      kind: 'create'
    });
  });
  test('Should update item', async () => {
    connector.db = {
      collection: jest.fn().mockImplementation(collection => ({
        doc: jest.fn().mockImplementation(id => ({
          set: jest.fn().mockResolvedValue({
            id: '1234',
            name: 'ABCD',
            kind: 'update'
          })
        }))
      }))
    };
    const resp = await connector.update('users', {
      name: 'ABCD'
    }, '1234');
    expect(resp).toEqual({
      id: '1234',
      name: 'ABCD',
      kind: 'update'
    });
  });
  test('Should delete item', async () => {
    connector.db = {
      collection: jest.fn().mockImplementation(collection => ({
        doc: jest.fn().mockImplementation(id => ({
          delete: jest.fn().mockResolvedValue(true)
        }))
      }))
    };
    const resp = await connector.delete('users', '1234');
    expect(resp).toBeTruthy();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRlc3QuanMiXSwibmFtZXMiOlsiXyIsInJlcXVpcmUiLCJsb2dnZXIiLCJmaXJlYmFzZUNvbm5lY3RvciIsImRlc2NyaWJlIiwiY29uZmlnIiwiZGF0YWJhc2UiLCJjb25uZWN0aW9ucyIsImRlZmF1bHQiLCJjb25uZWN0b3IiLCJzZXR0aW5ncyIsImNsaWVudCIsInNlcnZpY2VBY2NvdW50IiwicHJvY2VzcyIsImVudiIsIlNFUlZJQ0VfQUNDT1VOVF9QQVRIIiwib3B0aW9ucyIsInVzZU51bGxBc0RlZmF1bHQiLCJkZWZhdWx0Q29ubmVjdGlvbiIsImdsb2JhbCIsInNnQXBwIiwibG9nIiwiZ2V0IiwicGF0aCIsImRlZmF1bHRWYWx1ZSIsInNldCIsInZhbCIsImhhcyIsInRlc3QiLCJpbml0aWFsaXplIiwiZXhwZWN0IiwiZGIiLCJub3QiLCJ0b0JlTnVsbCIsImNvbGxlY3Rpb24iLCJqZXN0IiwiZm4iLCJtb2NrSW1wbGVtZW50YXRpb24iLCJ3aGVyZSIsImsiLCJvIiwidiIsIm9yZGVyQnkiLCJsaW1pdCIsIm1vY2tSZXNvbHZlZFZhbHVlIiwiZGF0YSIsImlkIiwibmFtZSIsImtpbmQiLCJyZXNwIiwiZmluZCIsImNvbmRpdGlvbnMiLCJlbWFpbCIsIm9yZGVyIiwidG9FcXVhbCIsIm9wZXJhdG9ycyIsImRvYyIsImZpbmRPbmUiLCJjcmVhdGUiLCJ1cGRhdGUiLCJkZWxldGUiLCJ0b0JlVHJ1dGh5Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxDQUFDLEdBQUdDLE9BQU8sQ0FBQyxRQUFELENBQWpCOztBQUNBLE1BQU1DLE1BQU0sR0FBR0QsT0FBTyxDQUFDLCtCQUFELENBQXRCOztBQUNBLE1BQU1FLGlCQUFpQixHQUFHRixPQUFPLENBQUMsVUFBRCxDQUFqQzs7QUFFQUcsUUFBUSxDQUFDLHlCQUFELEVBQTRCLE1BQU07QUFDeEMsUUFBTUMsTUFBTSxHQUFHO0FBQ2JDLElBQUFBLFFBQVEsRUFBRTtBQUNSQyxNQUFBQSxXQUFXLEVB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LENBQWFZLFVBQWI7QUFDRCxHQVhHLENBQUo7QUFZRCxDQWpNTyxDQUFSIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xuY29uc3QgbG9nZ2VyID0gcmVxdWlyZSgnLi4vLi4vLi4vLi4vdXRpbHMvbG9nZ2VyLnV0aWwnKTtcbmNvbnN0IGZpcmViYXNlQ29ubmVjdG9yID0gcmVxdWlyZSgnLi4vaW5kZXgnKTtcblxuZGVzY3JpYmUoJ0NyZWF0ZSBkYXRhYmFzZSBtYW5hZ2VyJywgKCkgPT4ge1xuICBjb25zdCBjb25maWcgPSB7XG4gICAgZGF0YWJhc2U6IHtcbiAgICAgIGNvbm5lY3Rpb25zOiB7XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICBjb25uZWN0b3I6ICdmaXJlYmFzZScsXG4gICAgICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgICAgIGNsaWVudDogJ2Nsb3VkZmlyZXN0b3JlJyxcbiAgICAgICAgICAgIHNlcnZpY2VBY2NvdW50OlxuICAgICAgICAgICAgICBwcm9jZXNzLmVudi5TRVJWSUNFX0FDQ09VTlRfUEFUSCB8fFxuICAgICAgICAgICAgICAnLi4vZmlyZWJhc2Uvc2VydmljZWFjY291bnQuanNvbicsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICB1c2VOdWxsQXNEZWZhdWx0OiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgZGVmYXVsdENvbm5lY3Rpb246ICdkZWZhdWx0JyxcbiAgICB9LFxuICB9O1xuICBnbG9iYWwuc2dBcHAgPSB7XG4gICAgbG9nOiBsb2dnZXIsXG4gICAgY29uZmlnOiB7XG4gICAgICAuLi5jb25maWcsXG4gICAgICBnZXQocGF0aCwgZGVmYXVsdFZhbHVlKSB7XG4gICAgICAgIHJldHVybiBfLmdldChjb25maWcsIHBhdGgsIGRlZmF1bHRWYWx1ZSk7XG4gICAgICB9LFxuXG4gICAgICBzZXQocGF0aCwgdmFsKSB7XG4gICAgICAgIF8uc2V0KGNvbmZpZywgcGF0aCwgdmFsKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9LFxuXG4gICAgICBoYXMocGF0aCkge1xuICAgICAgICByZXR1cm4gXy5oYXMoY29uZmlnLCBwYXRoKTtcbiAgICAgIH0sXG4gICAgfSxcbiAgfTtcblxuICBjb25zdCBjb25uZWN0b3IgPSBmaXJlYmFzZUNvbm5lY3RvcigpO1xuXG4gIHRlc3QoJ1Nob3VsZCBpbml0aWFsaXplJywgKCkgPT4ge1xuICAgIGNvbm5lY3Rvci5pbml0aWFsaXplKCk7XG4gICAgZXhwZWN0KGNvbm5lY3Rvci5kYikubm90LnRvQmVOdWxsKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ1Nob3VsZCBmaW5kIGl0ZW0nLCBhc3luYyAoKSA9PiB7XG4gICAgY29ubmVjdG9yLmRiID0ge1xuICAgICAgY29sbGVjdGlvbjogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoY29sbGVjdGlvbikgPT4gKHtcbiAgICAgICAgd2hlcmU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGssIG8sIHYpID0+ICh7XG4gICAgICAgICAgb3JkZXJCeTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoaywgdikgPT4gKHtcbiAgICAgICAgICAgIGxpbWl0OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCh2KSA9PiAoe1xuICAgICAgICAgICAgICBnZXQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgZGF0YSgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZDogJzEyMzQnLFxuICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdBQkNEJyxcbiAgICAgICAgICAgICAgICAgICAgICBraW5kOiAnZmluZCcsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgIH0pKSxcbiAgICAgICAgfSkpLFxuICAgICAgfSkpLFxuICAgIH07XG5cbiAgICBjb25zdCByZXNwID0gYXdhaXQgY29ubmVjdG9yLmZpbmQoJ3VzZXJzJywge1xuICAgICAgY29uZGl0aW9uczogeyBlbWFpbDogJ3Rlc3RAZ21haWwuY29tJyB9LFxuICAgICAgb3JkZXI6IHsgazogJ25hbWUnLCB2OiAnYXNjJyB9LFxuICAgICAgbGltaXQ6IDEsXG4gICAgfSk7XG4gICAgZXhwZWN0KHJlc3ApLnRvRXF1YWwoW3sgaWQ6ICcxMjM0JywgbmFtZTogJ0FCQ0QnLCBraW5kOiAnZmluZCcgfV0pO1xuICB9KTtcblxuICB0ZXN0KCdTaG91bGQgZmluZCBpdGVtIHdpdGggb3BlcmF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbm5lY3Rvci5kYiA9IHtcbiAgICAgIGNvbGxlY3Rpb246IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGNvbGxlY3Rpb24pID0+ICh7XG4gICAgICAgIHdoZXJlOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChrLCBvLCB2KSA9PiAoe1xuICAgICAgICAgIG9yZGVyQnk6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGssIHYpID0+ICh7XG4gICAgICAgICAgICBsaW1pdDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigodikgPT4gKHtcbiAgICAgICAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIGRhdGEoKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgaWQ6ICcxMjM0JyxcbiAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnQUJDRCcsXG4gICAgICAgICAgICAgICAgICAgICAga2luZDogJ2ZpbmQnLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICB9KSksXG4gICAgICAgIH0pKSxcbiAgICAgIH0pKSxcbiAgICB9O1xuXG4gICAgY29uc3QgcmVzcCA9IGF3YWl0IGNvbm5lY3Rvci5maW5kKCd1c2VycycsIHtcbiAgICAgIGNvbmRpdGlvbnM6IHsgZW1haWw6ICd0ZXN0QGdtYWlsLmNvbScgfSxcbiAgICAgIG9yZGVyOiB7IGs6ICduYW1lJywgdjogJ2FzYycgfSxcbiAgICAgIG9wZXJhdG9yczogeyBlbWFpbDogJz09JyB9LFxuICAgICAgbGltaXQ6IDEsXG4gICAgfSk7XG4gICAgZXhwZWN0KHJlc3ApLnRvRXF1YWwoW3sgaWQ6ICcxMjM0JywgbmFtZTogJ0FCQ0QnLCBraW5kOiAnZmluZCcgfV0pO1xuICB9KTtcblxuICB0ZXN0KCdTaG91bGQgZmluZCBpdGVtIHdpdGggcXVlcnkgaXMgZW1wdHknLCBhc3luYyAoKSA9PiB7XG4gICAgY29ubmVjdG9yLmRiID0ge1xuICAgICAgY29sbGVjdGlvbjogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoY29sbGVjdGlvbikgPT4gKHtcbiAgICAgICAgZ2V0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGRhdGEoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaWQ6ICcxMjM0JyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnQUJDRCcsXG4gICAgICAgICAgICAgICAga2luZDogJ2ZpbmQnLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICBdKSxcbiAgICAgIH0pKSxcbiAgICB9O1xuXG4gICAgY29uc3QgcmVzcCA9IGF3YWl0IGNvbm5lY3Rvci5maW5kKCd1c2VycycpO1xuICAgIGV4cGVjdChyZXNwKS50b0VxdWFsKFt7IGlkOiAnMTIzNCcsIG5hbWU6ICdBQkNEJywga2luZDogJ2ZpbmQnIH1dKTtcbiAgfSk7XG5cbiAgdGVzdCgnU2hvdWxkIGZpbmRPbmUgaXRlbScsIGFzeW5jICgpID0+IHtcbiAgICBjb25uZWN0b3IuZGIgPSB7XG4gICAgICBjb2xsZWN0aW9uOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChjb2xsZWN0aW9uKSA9PiAoe1xuICAgICAgICBkb2M6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGlkKSA9PiAoe1xuICAgICAgICAgIGdldDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgICAgIGRhdGEoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaWQ6ICcxMjM0JyxcbiAgICAgICAgICAgICAgICBuYW1lOiAnQUJDRCcsXG4gICAgICAgICAgICAgICAga2luZDogJ2ZpbmRPbmUnLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSkpLFxuICAgICAgfSkpLFxuICAgIH07XG5cbiAgICBjb25zdCByZXNwID0gYXdhaXQgY29ubmVjdG9yLmZpbmRPbmUoJ3VzZXJzJywgJzEyMzQnKTtcbiAgICBleHBlY3QocmVzcCkudG9FcXVhbCh7IGlkOiAnMTIzNCcsIG5hbWU6ICdBQkNEJywga2luZDogJ2ZpbmRPbmUnIH0pO1xuICB9KTtcblxuICB0ZXN0KCdTaG91bGQgY3JlYXRlIGl0ZW0nLCBhc3luYyAoKSA9PiB7XG4gICAgY29ubmVjdG9yLmRiID0ge1xuICAgICAgY29sbGVjdGlvbjogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoY29sbGVjdGlvbikgPT4gKHtcbiAgICAgICAgZG9jOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChpZCkgPT4gKHtcbiAgICAgICAgICBzZXQ6IGplc3RcbiAgICAgICAgICAgIC5mbigpXG4gICAgICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJzEyMzQnLCBuYW1lOiAnQUJDRCcsIGtpbmQ6ICdjcmVhdGUnIH0pLFxuICAgICAgICB9KSksXG4gICAgICB9KSksXG4gICAgfTtcblxuICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBjb25uZWN0b3IuY3JlYXRlKCd1c2VycycsIHsgbmFtZTogJ0FCQ0QnIH0sICcxMjM0Jyk7XG4gICAgZXhwZWN0KHJlc3ApLnRvRXF1YWwoeyBpZDogJzEyMzQnLCBuYW1lOiAnQUJDRCcsIGtpbmQ6ICdjcmVhdGUnIH0pO1xuICB9KTtcblxuICB0ZXN0KCdTaG91bGQgdXBkYXRlIGl0ZW0nLCBhc3luYyAoKSA9PiB7XG4gICAgY29ubmVjdG9yLmRiID0ge1xuICAgICAgY29sbGVjdGlvbjogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoY29sbGVjdGlvbikgPT4gKHtcbiAgICAgICAgZG9jOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChpZCkgPT4gKHtcbiAgICAgICAgICBzZXQ6IGplc3RcbiAgICAgICAgICAgIC5mbigpXG4gICAgICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogJzEyMzQnLCBuYW1lOiAnQUJDRCcsIGtpbmQ6ICd1cGRhdGUnIH0pLFxuICAgICAgICB9KSksXG4gICAgICB9KSksXG4gICAgfTtcblxuICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBjb25uZWN0b3IudXBkYXRlKCd1c2VycycsIHsgbmFtZTogJ0FCQ0QnIH0sICcxMjM0Jyk7XG4gICAgZXhwZWN0KHJlc3ApLnRvRXF1YWwoeyBpZDogJzEyMzQnLCBuYW1lOiAnQUJDRCcsIGtpbmQ6ICd1cGRhdGUnIH0pO1xuICB9KTtcblxuICB0ZXN0KCdTaG91bGQgZGVsZXRlIGl0ZW0nLCBhc3luYyAoKSA9PiB7XG4gICAgY29ubmVjdG9yLmRiID0ge1xuICAgICAgY29sbGVjdGlvbjogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoY29sbGVjdGlvbikgPT4gKHtcbiAgICAgICAgZG9jOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChpZCkgPT4gKHtcbiAgICAgICAgICBkZWxldGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgICAgICAgfSkpLFxuICAgICAgfSkpLFxuICAgIH07XG5cbiAgICBjb25zdCByZXNwID0gYXdhaXQgY29ubmVjdG9yLmRlbGV0ZSgndXNlcnMnLCAnMTIzNCcpO1xuICAgIGV4cGVjdChyZXNwKS50b0JlVHJ1dGh5KCk7XG4gIH0pO1xufSk7XG4iXX0=