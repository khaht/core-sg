241be3825f933d11b1a1381d3f65f807
const logger = require('utils/logger.util');

const _ = require('lodash');

const createConnectorRegistry = require('../connector-registry');

describe('Create connector registry', () => {
  const config = {
    database: {
      connections: {
        default: {
          connector: 'firebase',
          settings: {
            client: 'cloudfirestore',
            serviceAccount: process.env.SERVICE_ACCOUNT_PATH || '../firebase/serviceaccount.json'
          },
          options: {
            useNullAsDefault: true
          }
        }
      }
    }
  };
  global.sgApp = {
    log: logger,
    config: { ...config,

      get(path, defaultValue) {
        return _.get(config, path, defaultValue);
      },

      set(path, val) {
        _.set(config, path, val);

        return this;
      },

      has(path) {
        return _.has(config, path);
      }

    }
  };
  const connections = {
    default: {
      connector: 'firebase',
      settings: {
        client: 'cloudfirestore',
        serviceAccount: process.env.SERVICE_ACCOUNT_PATH || '../firebase/serviceaccount.json'
      },
      options: {
        useNullAsDefault: true
      }
    }
  };
  const defaultConnection = 'default';
  const connectors = createConnectorRegistry({
    defaultConnection,
    connections
  });
  connectors.load();
  test('Should create connector registry', () => {
    expect(Object.keys(connectors)).toEqual(['load', 'initialize', 'getAll', 'get', 'set', 'default', 'getByConnection']);
  });
  test('Should ignore if connector modules loaded', () => {
    connectors.load();
  });
  test('Should initialize connectors', async () => {
    await connectors.initialize();
  });
  test('Should get all connectors', () => {
    const resp = connectors.getAll();
    expect(resp.length).toBe(1);
  });
  test('Should get connector by key', () => {
    const resp = connectors.get('firebase');
    expect(Object.keys(resp)).toEqual(['db', 'initialize', 'parseSnapshots', 'find', 'findOne', 'create', 'update', 'delete']);
  });
  test('Should set connector by key', () => {
    const fn = jest.fn();
    connectors.set('dynamodb', {
      find: fn
    });
    const resp = connectors.get('dynamodb');
    expect(resp).toEqual({
      find: fn
    });
  });
  test('Should get default connector', () => {
    const _default = connectors.default;
    expect(Object.keys(_default)).toEqual(['db', 'initialize', 'parseSnapshots', 'find', 'findOne', 'create', 'update', 'delete']);
  });
  test('Should get by connection', () => {
    const resp = connectors.getByConnection('default');
    expect(Object.keys(resp)).toEqual(['db', 'initialize', 'parseSnapshots', 'find', 'findOne', 'create', 'update', 'delete']);
  });
  test('Should throw error when get by connection not exists', () => {
    expect(() => connectors.getByConnection('connection')).toThrow();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbm5lY3Rvci1yZWdpc3RyeS50ZXN0LmpzIl0sIm5hbWVzIjpbImxvZ2dlciIsInJlcXVpcmUiLCJfIiwiY3JlYXRlQ29ubmVjdG9yUmVnaXN0cnkiLCJkZXNjcmliZSIsImNvbmZpZyIsImRhdGFiYXNlIiwiY29ubmVjdGlvbnMiLCJkZWZhdWx0IiwiY29ubmVjdG9yIiwic2V0dGluZ3MiLCJjbGllbnQiLCJzZXJ2aWNlQWNjb3VudCIsInByb2Nlc3MiLCJlbnYiLCJTRVJWSUNFX0FDQ09VTlRfUEFUSCIsIm9wdGlvbnMiLCJ1c2VOdWxsQXNEZWZhdWx0IiwiZ2xvYmFsIiwic2dBcHAiLCJsb2ciLCJnZXQiLCJwYXRoIiwiZGVmYXVsdFZhbHVlIiwic2V0IiwidmFsIiwiaGFzIiwiZGVmYXVsdENvbm5lY3Rpb24iLCJjb25uZWN0b3JzIiwibG9hZCIsInRlc3QiLCJleHBlY3QiLCJPYmplY3QiLCJrZXlzIiwidG9FcXVhbCIsImluaXRpYWxpemUiLCJyZXNwIiwiZ2V0QWxsIiwibGVuZ3RoIiwidG9CZSIsImZuIiwiamVzdCIsImZpbmQiLCJfZGVmYXVsdCIsImdldEJ5Q29ubmVjdGlvbiIsInRvVGhyb3ciXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE1BQU0sR0FBR0MsT0FBTyxDQUFDLG1CQUFELENBQXRCOztBQUNBLE1BQU1DLENBQUMsR0FBR0QsT0FBTyxDQUFDLFFBQUQsQ0FBakI7O0FBQ0EsTUFBTUUsdUJBQXVCLEdBQUdGLE9BQU8sQ0FBQyx1QkFBRCxDQUF2Qzs7QUFFQUcsUUFBUSxDQUFDLDJCQUFELEVBQThCLE1BQU07QUFDMUMsUUFBTUMsTUFBTSxHQUFHO0FBQ2JDLElBQUFBLFFBQVEsRUFBRTtBQUNSQyxNQUFBQSxXQUFXLEVBQUU7QUFDWEMsUUFBQUEsT0FBTyxFQUFFO0FBQ1BDLFVBQUFBLFNBQVMsRUFBRSxVQURKO0FBRVBDLFVBQUFBLFFBQVEsRUFBRTtBQUNSQyxZQUFBQSxNQUFNLEVBQUUsZ0JBREE7QUFFUkMsWUFBQUEsY0FB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QyxFQU9oQyxRQVBnQyxFQVFoQyxRQVJnQyxDQUFsQztBQVVELEdBWkcsQ0FBSjtBQWNBSixFQUFBQSxJQUFJLENBQUMsc0RBQUQsRUFBeUQsTUFBTTtBQUNqRUMsSUFBQUEsTUFBTSxDQUFDLE1BQU1ILFVBQVUsQ0FBQ2dCLGVBQVgsQ0FBMkIsWUFBM0IsQ0FBUCxDQUFOLENBQXVEQyxPQUF2RDtBQUNELEdBRkcsQ0FBSjtBQUdELENBeklPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBsb2dnZXIgPSByZXF1aXJlKCd1dGlscy9sb2dnZXIudXRpbCcpO1xuY29uc3QgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xuY29uc3QgY3JlYXRlQ29ubmVjdG9yUmVnaXN0cnkgPSByZXF1aXJlKCcuLi9jb25uZWN0b3ItcmVnaXN0cnknKTtcblxuZGVzY3JpYmUoJ0NyZWF0ZSBjb25uZWN0b3IgcmVnaXN0cnknLCAoKSA9PiB7XG4gIGNvbnN0IGNvbmZpZyA9IHtcbiAgICBkYXRhYmFzZToge1xuICAgICAgY29ubmVjdGlvbnM6IHtcbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIGNvbm5lY3RvcjogJ2ZpcmViYXNlJyxcbiAgICAgICAgICBzZXR0aW5nczoge1xuICAgICAgICAgICAgY2xpZW50OiAnY2xvdWRmaXJlc3RvcmUnLFxuICAgICAgICAgICAgc2VydmljZUFjY291bnQ6XG4gICAgICAgICAgICAgIHByb2Nlc3MuZW52LlNFUlZJQ0VfQUNDT1VOVF9QQVRIIHx8XG4gICAgICAgICAgICAgICcuLi9maXJlYmFzZS9zZXJ2aWNlYWNjb3VudC5qc29uJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIHVzZU51bGxBc0RlZmF1bHQ6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfTtcblxuICBnbG9iYWwuc2dBcHAgPSB7XG4gICAgbG9nOiBsb2dnZXIsXG4gICAgY29uZmlnOiB7XG4gICAgICAuLi5jb25maWcsXG5cbiAgICAgIGdldChwYXRoLCBkZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIF8uZ2V0KGNvbmZpZywgcGF0aCwgZGVmYXVsdFZhbHVlKTtcbiAgICAgIH0sXG5cbiAgICAgIHNldChwYXRoLCB2YWwpIHtcbiAgICAgICAgXy5zZXQoY29uZmlnLCBwYXRoLCB2YWwpO1xuXG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfSxcblxuICAgICAgaGFzKHBhdGgpIHtcbiAgICAgICAgcmV0dXJuIF8uaGFzKGNvbmZpZywgcGF0aCk7XG4gICAgICB9LFxuICAgIH0sXG4gIH07XG4gIGNvbnN0IGNvbm5lY3Rpb25zID0ge1xuICAgIGRlZmF1bHQ6IHtcbiAgICAgIGNvbm5lY3RvcjogJ2ZpcmViYXNlJyxcbiAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgIGNsaWVudDogJ2Nsb3VkZmlyZXN0b3JlJyxcbiAgICAgICAgc2VydmljZUFjY291bnQ6XG4gICAgICAgICAgcHJvY2Vzcy5lbnYuU0VSVklDRV9BQ0NPVU5UX1BBVEggfHwgJy4uL2ZpcmViYXNlL3NlcnZpY2VhY2NvdW50Lmpzb24nLFxuICAgICAgfSxcbiAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgdXNlTnVsbEFzRGVmYXVsdDogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfTtcbiAgY29uc3QgZGVmYXVsdENvbm5lY3Rpb24gPSAnZGVmYXVsdCc7XG4gIGNvbnN0IGNvbm5lY3RvcnMgPSBjcmVhdGVDb25uZWN0b3JSZWdpc3RyeSh7XG4gICAgZGVmYXVsdENvbm5lY3Rpb24sXG4gICAgY29ubmVjdGlvbnMsXG4gIH0pO1xuICBjb25uZWN0b3JzLmxvYWQoKTtcblxuICB0ZXN0KCdTaG91bGQgY3JlYXRlIGNvbm5lY3RvciByZWdpc3RyeScsICgpID0+IHtcbiAgICBleHBlY3QoT2JqZWN0LmtleXMoY29ubmVjdG9ycykpLnRvRXF1YWwoW1xuICAgICAgJ2xvYWQnLFxuICAgICAgJ2luaXRpYWxpemUnLFxuICAgICAgJ2dldEFsbCcsXG4gICAgICAnZ2V0JyxcbiAgICAgICdzZXQnLFxuICAgICAgJ2RlZmF1bHQnLFxuICAgICAgJ2dldEJ5Q29ubmVjdGlvbicsXG4gICAgXSk7XG4gIH0pO1xuXG4gIHRlc3QoJ1Nob3VsZCBpZ25vcmUgaWYgY29ubmVjdG9yIG1vZHVsZXMgbG9hZGVkJywgKCkgPT4ge1xuICAgIGNvbm5lY3RvcnMubG9hZCgpO1xuICB9KTtcblxuICB0ZXN0KCdTaG91bGQgaW5pdGlhbGl6ZSBjb25uZWN0b3JzJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGNvbm5lY3RvcnMuaW5pdGlhbGl6ZSgpO1xuICB9KTtcblxuICB0ZXN0KCdTaG91bGQgZ2V0IGFsbCBjb25uZWN0b3JzJywgKCkgPT4ge1xuICAgIGNvbnN0IHJlc3AgPSBjb25uZWN0b3JzLmdldEFsbCgpO1xuICAgIGV4cGVjdChyZXNwLmxlbmd0aCkudG9CZSgxKTtcbiAgfSk7XG5cbiAgdGVzdCgnU2hvdWxkIGdldCBjb25uZWN0b3IgYnkga2V5JywgKCkgPT4ge1xuICAgIGNvbnN0IHJlc3AgPSBjb25uZWN0b3JzLmdldCgnZmlyZWJhc2UnKTtcbiAgICBleHBlY3QoT2JqZWN0LmtleXMocmVzcCkpLnRvRXF1YWwoW1xuICAgICAgJ2RiJyxcbiAgICAgICdpbml0aWFsaXplJyxcbiAgICAgICdwYXJzZVNuYXBzaG90cycsXG4gICAgICAnZmluZCcsXG4gICAgICAnZmluZE9uZScsXG4gICAgICAnY3JlYXRlJyxcbiAgICAgICd1cGRhdGUnLFxuICAgICAgJ2RlbGV0ZScsXG4gICAgXSk7XG4gIH0pO1xuXG4gIHRlc3QoJ1Nob3VsZCBzZXQgY29ubmVjdG9yIGJ5IGtleScsICgpID0+IHtcbiAgICBjb25zdCBmbiA9IGplc3QuZm4oKTtcbiAgICBjb25uZWN0b3JzLnNldCgnZHluYW1vZGInLCB7IGZpbmQ6IGZuIH0pO1xuICAgIGNvbnN0IHJlc3AgPSBjb25uZWN0b3JzLmdldCgnZHluYW1vZGInKTtcbiAgICBleHBlY3QocmVzcCkudG9FcXVhbCh7IGZpbmQ6IGZuIH0pO1xuICB9KTtcblxuICB0ZXN0KCdTaG91bGQgZ2V0IGRlZmF1bHQgY29ubmVjdG9yJywgKCkgPT4ge1xuICAgIGNvbnN0IF9kZWZhdWx0ID0gY29ubmVjdG9ycy5kZWZhdWx0O1xuICAgIGV4cGVjdChPYmplY3Qua2V5cyhfZGVmYXVsdCkpLnRvRXF1YWwoW1xuICAgICAgJ2RiJyxcbiAgICAgICdpbml0aWFsaXplJyxcbiAgICAgICdwYXJzZVNuYXBzaG90cycsXG4gICAgICAnZmluZCcsXG4gICAgICAnZmluZE9uZScsXG4gICAgICAnY3JlYXRlJyxcbiAgICAgICd1cGRhdGUnLFxuICAgICAgJ2RlbGV0ZScsXG4gICAgXSk7XG4gIH0pO1xuXG4gIHRlc3QoJ1Nob3VsZCBnZXQgYnkgY29ubmVjdGlvbicsICgpID0+IHtcbiAgICBjb25zdCByZXNwID0gY29ubmVjdG9ycy5nZXRCeUNvbm5lY3Rpb24oJ2RlZmF1bHQnKTtcbiAgICBleHBlY3QoT2JqZWN0LmtleXMocmVzcCkpLnRvRXF1YWwoW1xuICAgICAgJ2RiJyxcbiAgICAgICdpbml0aWFsaXplJyxcbiAgICAgICdwYXJzZVNuYXBzaG90cycsXG4gICAgICAnZmluZCcsXG4gICAgICAnZmluZE9uZScsXG4gICAgICAnY3JlYXRlJyxcbiAgICAgICd1cGRhdGUnLFxuICAgICAgJ2RlbGV0ZScsXG4gICAgXSk7XG4gIH0pO1xuXG4gIHRlc3QoJ1Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIGdldCBieSBjb25uZWN0aW9uIG5vdCBleGlzdHMnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IGNvbm5lY3RvcnMuZ2V0QnlDb25uZWN0aW9uKCdjb25uZWN0aW9uJykpLnRvVGhyb3coKTtcbiAgfSk7XG59KTtcbiJdfQ==