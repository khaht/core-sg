{"version":3,"sources":["content-types.util.js"],"names":["_","require","SINGLE_TYPE","COLLECTION_TYPE","ID_ATTRIBUTE","PUBLISHED_AT_ATTRIBUTE","CREATED_BY_ATTRIBUTE","UPDATED_BY_ATTRIBUTE","DP_PUB_STATE_LIVE","DP_PUB_STATE_PREVIEW","DP_PUB_STATES","NON_WRITABLE_ATTRIBUTES","NON_VISIBLE_ATTRIBUTES","constants","getTimestamps","model","timestamps","get","isArray","getTimestampsAttributes","reduce","attributes","attributeName","type","getNonWritableAttributes","nonWritableAttributes","acc","attr","attrName","writable","concat","uniq","primaryKey","getWritableAttributes","difference","Object","keys","getNonVisibleAttributes","getVisibleAttributes","hasDraftAndPublish","isDraft","data","isSingleType","kind","isCollectionType","isKind","getPrivateAttributes","union","sgApp","config","pickBy","private","isPrivateAttribute","privateAttributes","includes","isScalarAttribute","attribute","collection","isMediaAttribute","plugin","module","exports"],"mappings":"AAAA;AACA,MAAMA,CAAC,GAAGC,OAAO,CAAC,QAAD,CAAjB;;AAEA,MAAMC,WAAW,GAAG,YAApB;AACA,MAAMC,eAAe,GAAG,gBAAxB;AAEA,MAAMC,YAAY,GAAG,IAArB;AACA,MAAMC,sBAAsB,GAAG,cAA/B;AACA,MAAMC,oBAAoB,GAAG,YAA7B;AACA,MAAMC,oBAAoB,GAAG,YAA7B;AACA,MAAMC,iBAAiB,GAAG,MAA1B;AACA,MAAMC,oBAAoB,GAAG,SAA7B;AACA,MAAMC,aAAa,GAAG,CAACF,iBAAD,EAAoBC,oBAApB,CAAtB;AAEA,MAAME,uBAAuB,GAAG,CAACP,YAAD,EAAeE,oBAAf,EAAqCC,oBAArC,CAAhC;AACA,MAAMK,sBAAsB,GAAG,CAAC,GAAGD,uBAAJ,EAA6BN,sBAA7B,CAA/B;AAEA,MAAMQ,SAAS,GAAG;AAChBT,EAAAA,YADgB;AAEhBC,EAAAA,sBAFgB;AAIhBC,EAAAA,oBAJgB;AAKhBC,EAAAA,oBALgB;AAMhBG,EAAAA,aANgB;AAOhBF,EAAAA,iBAPgB;AAQhBC,EAAAA,oBARgB;AAShBP,EAAAA,WATgB;AAUhBC,EAAAA;AAVgB,CAAlB;;AAaA,MAAMW,aAAa,GAAIC,KAAD,IAAW;AAC/B,QAAMC,UAAU,GAAGhB,CAAC,CAACiB,GAAF,CAAMF,KAAN,EAAa,oBAAb,EAAmC,EAAnC,CAAnB;;AAEA,MAAI,CAACf,CAAC,CAACkB,OAAF,CAAUF,UAAV,CAAL,EAA4B;AAC1B,WAAO,EAAP;AACD;;AAED,SAAOA,UAAP;AACD,CARD;;AAUA,MAAMG,uBAAuB,GAAIJ,KAAD,IAAW;AACzC,QAAMC,UAAU,GAAGF,aAAa,CAACC,KAAD,CAAhC;AAEA,SAAOC,UAAU,CAACI,MAAX,CACL,CAACC,UAAD,EAAaC,aAAb,MAAgC,EAC9B,GAAGD,UAD2B;AAE9B,KAACC,aAAD,GAAiB;AAAEC,MAAAA,IAAI,EAAE;AAAR;AAFa,GAAhC,CADK,EAKL,EALK,CAAP;AAOD,CAVD;;AAYA,MAAMC,wBAAwB,GAAG,CAACT,KAAK,GAAG,EAAT,KAAgB;AAC/C,QAAMU,qBAAqB,GAAGzB,CAAC,CAACoB,MAAF,CAC5BL,KAAK,CAACM,UADsB,EAE5B,CAACK,GAAD,EAAMC,IAAN,EAAYC,QAAZ,KAA0BD,IAAI,CAACE,QAAL,KAAkB,KAAlB,GAA0BH,GAAG,CAACI,MAAJ,CAAWF,QAAX,CAA1B,GAAiDF,GAF/C,EAG5B,EAH4B,CAA9B;;AAMA,SAAO1B,CAAC,CAAC+B,IAAF,CACLpB,uBAAuB,CAACmB,MAAxB,CAA+Bf,KAAK,CAACiB,UAArC,EAAiDlB,aAAa,CAACC,KAAD,CAA9D,EAAuEU,qBAAvE,CADK,CAAP;AAGD,CAVD;;AAYA,MAAMQ,qBAAqB,GAAIlB,KAAD,IAAWf,CAAC,CAACkC,UAAF,CAAaC,MAAM,CAACC,IAAP,CAAYrB,KAAK,CAACM,UAAlB,CAAb,EAA4CG,wBAAwB,CAACT,KAAD,CAApE,CAAzC;;AAEA,MAAMsB,uBAAuB,GAAItB,KAAD,IAAWf,CAAC,CAAC+B,IAAF,CAAO,CAAChB,KAAK,CAACiB,UAAP,EAAmB,GAAGlB,aAAa,CAACC,KAAD,CAAnC,EAA4C,GAAGH,sBAA/C,CAAP,CAA3C;;AAEA,MAAM0B,oBAAoB,GAAIvB,KAAD,IAAWf,CAAC,CAACkC,UAAF,CAAalC,CAAC,CAACoC,IAAF,CAAOrB,KAAK,CAACM,UAAb,CAAb,EAAuCgB,uBAAuB,CAACtB,KAAD,CAA9D,CAAxC;;AAEA,MAAMwB,kBAAkB,GAAIxB,KAAD,IAAWf,CAAC,CAACiB,GAAF,CAAMF,KAAN,EAAa,yBAAb,EAAwC,KAAxC,MAAmD,IAAzF;;AAEA,MAAMyB,OAAO,GAAG,CAACC,IAAD,EAAO1B,KAAP,KAAiBwB,kBAAkB,CAACxB,KAAD,CAAlB,IAA6Bf,CAAC,CAACiB,GAAF,CAAMwB,IAAN,EAAYpC,sBAAZ,MAAwC,IAAtG;;AAEA,MAAMqC,YAAY,GAAG,CAAC;AAAEC,EAAAA,IAAI,GAAGxC;AAAT,CAAD,KAAgCwC,IAAI,KAAKzC,WAA9D;;AACA,MAAM0C,gBAAgB,GAAG,CAAC;AAAED,EAAAA,IAAI,GAAGxC;AAAT,CAAD,KAAgCwC,IAAI,KAAKxC,eAAlE;;AACA,MAAM0C,MAAM,GAAIF,IAAD,IAAW5B,KAAD,IAAWA,KAAK,CAAC4B,IAAN,KAAeA,IAAnD;;AAEA,MAAMG,oBAAoB,GAAI/B,KAAD,IAAWf,CAAC,CAAC+C,KAAF,CACtCC,KAAK,CAACC,MAAN,CAAahC,GAAb,CAAiB,iCAAjB,EAAoD,EAApD,CADsC,EAEtCjB,CAAC,CAACiB,GAAF,CAAMF,KAAN,EAAa,2BAAb,EAA0C,EAA1C,CAFsC,EAGtCf,CAAC,CAACoC,IAAF,CAAOpC,CAAC,CAACkD,MAAF,CAASnC,KAAK,CAACM,UAAf,EAA4BM,IAAD,IAAU,CAAC,CAACA,IAAI,CAACwB,OAA5C,CAAP,CAHsC,CAAxC;;AAMA,MAAMC,kBAAkB,GAAG,CAACrC,KAAK,GAAG,EAAT,EAAaO,aAAb,KAA+BP,KAAK,IAAIA,KAAK,CAACsC,iBAAf,IAAoCtC,KAAK,CAACsC,iBAAN,CAAwBC,QAAxB,CAAiChC,aAAjC,CAA9F;;AAEA,MAAMiC,iBAAiB,GAAIC,SAAD,IACxB,CAACA,SAAS,CAACC,UAAX,IACG,CAACD,SAAS,CAACzC,KADd,IAEGyC,SAAS,CAACjC,IAAV,KAAmB,WAFtB,IAGGiC,SAAS,CAACjC,IAAV,KAAmB,aAJxB;;AAOA,MAAMmC,gBAAgB,GAAI/B,IAAD,IAAU,CAACA,IAAI,CAAC8B,UAAL,IAAmB9B,IAAI,CAACZ,KAAzB,MAAoC,MAApC,IAA8CY,IAAI,CAACgC,MAAL,KAAgB,QAAjG;;AAEAC,MAAM,CAACC,OAAP,GAAiB;AACfN,EAAAA,iBADe;AAEfG,EAAAA,gBAFe;AAGfZ,EAAAA,oBAHe;AAIf3B,EAAAA,uBAJe;AAKfiC,EAAAA,kBALe;AAMfvC,EAAAA,SANe;AAOfW,EAAAA,wBAPe;AAQfS,EAAAA,qBARe;AASfI,EAAAA,uBATe;AAUfC,EAAAA,oBAVe;AAWfC,EAAAA,kBAXe;AAYfC,EAAAA,OAZe;AAafE,EAAAA,YAbe;AAcfE,EAAAA,gBAde;AAefC,EAAAA;AAfe,CAAjB","sourcesContent":["/* eslint-disable max-len */\nconst _ = require('lodash');\n\nconst SINGLE_TYPE = 'singleType';\nconst COLLECTION_TYPE = 'collectionType';\n\nconst ID_ATTRIBUTE = 'id';\nconst PUBLISHED_AT_ATTRIBUTE = 'published_at';\nconst CREATED_BY_ATTRIBUTE = 'created_by';\nconst UPDATED_BY_ATTRIBUTE = 'updated_by';\nconst DP_PUB_STATE_LIVE = 'live';\nconst DP_PUB_STATE_PREVIEW = 'preview';\nconst DP_PUB_STATES = [DP_PUB_STATE_LIVE, DP_PUB_STATE_PREVIEW];\n\nconst NON_WRITABLE_ATTRIBUTES = [ID_ATTRIBUTE, CREATED_BY_ATTRIBUTE, UPDATED_BY_ATTRIBUTE];\nconst NON_VISIBLE_ATTRIBUTES = [...NON_WRITABLE_ATTRIBUTES, PUBLISHED_AT_ATTRIBUTE];\n\nconst constants = {\n  ID_ATTRIBUTE,\n  PUBLISHED_AT_ATTRIBUTE,\n\n  CREATED_BY_ATTRIBUTE,\n  UPDATED_BY_ATTRIBUTE,\n  DP_PUB_STATES,\n  DP_PUB_STATE_LIVE,\n  DP_PUB_STATE_PREVIEW,\n  SINGLE_TYPE,\n  COLLECTION_TYPE,\n};\n\nconst getTimestamps = (model) => {\n  const timestamps = _.get(model, 'options.timestamps', []);\n\n  if (!_.isArray(timestamps)) {\n    return [];\n  }\n\n  return timestamps;\n};\n\nconst getTimestampsAttributes = (model) => {\n  const timestamps = getTimestamps(model);\n\n  return timestamps.reduce(\n    (attributes, attributeName) => ({\n      ...attributes,\n      [attributeName]: { type: 'timestamp' },\n    }),\n    {},\n  );\n};\n\nconst getNonWritableAttributes = (model = {}) => {\n  const nonWritableAttributes = _.reduce(\n    model.attributes,\n    (acc, attr, attrName) => (attr.writable === false ? acc.concat(attrName) : acc),\n    [],\n  );\n\n  return _.uniq(\n    NON_WRITABLE_ATTRIBUTES.concat(model.primaryKey, getTimestamps(model), nonWritableAttributes),\n  );\n};\n\nconst getWritableAttributes = (model) => _.difference(Object.keys(model.attributes), getNonWritableAttributes(model));\n\nconst getNonVisibleAttributes = (model) => _.uniq([model.primaryKey, ...getTimestamps(model), ...NON_VISIBLE_ATTRIBUTES]);\n\nconst getVisibleAttributes = (model) => _.difference(_.keys(model.attributes), getNonVisibleAttributes(model));\n\nconst hasDraftAndPublish = (model) => _.get(model, 'options.draftAndPublish', false) === true;\n\nconst isDraft = (data, model) => hasDraftAndPublish(model) && _.get(data, PUBLISHED_AT_ATTRIBUTE) === null;\n\nconst isSingleType = ({ kind = COLLECTION_TYPE }) => kind === SINGLE_TYPE;\nconst isCollectionType = ({ kind = COLLECTION_TYPE }) => kind === COLLECTION_TYPE;\nconst isKind = (kind) => (model) => model.kind === kind;\n\nconst getPrivateAttributes = (model) => _.union(\n  sgApp.config.get('api.responses.privateAttributes', []),\n  _.get(model, 'options.privateAttributes', []),\n  _.keys(_.pickBy(model.attributes, (attr) => !!attr.private)),\n);\n\nconst isPrivateAttribute = (model = {}, attributeName) => model && model.privateAttributes && model.privateAttributes.includes(attributeName);\n\nconst isScalarAttribute = (attribute) => (\n  !attribute.collection\n  && !attribute.model\n  && attribute.type !== 'component'\n  && attribute.type !== 'dynamiczone'\n);\n\nconst isMediaAttribute = (attr) => (attr.collection || attr.model) === 'file' && attr.plugin === 'upload';\n\nmodule.exports = {\n  isScalarAttribute,\n  isMediaAttribute,\n  getPrivateAttributes,\n  getTimestampsAttributes,\n  isPrivateAttribute,\n  constants,\n  getNonWritableAttributes,\n  getWritableAttributes,\n  getNonVisibleAttributes,\n  getVisibleAttributes,\n  hasDraftAndPublish,\n  isDraft,\n  isSingleType,\n  isCollectionType,\n  isKind,\n};\n"]}