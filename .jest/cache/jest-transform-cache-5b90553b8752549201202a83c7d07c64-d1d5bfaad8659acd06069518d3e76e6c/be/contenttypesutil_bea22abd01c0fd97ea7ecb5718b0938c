9c15c981410e50f4bccc6764038437b7
/* eslint-disable max-len */
const _ = require('lodash');

const SINGLE_TYPE = 'singleType';
const COLLECTION_TYPE = 'collectionType';
const ID_ATTRIBUTE = 'id';
const PUBLISHED_AT_ATTRIBUTE = 'published_at';
const CREATED_BY_ATTRIBUTE = 'created_by';
const UPDATED_BY_ATTRIBUTE = 'updated_by';
const DP_PUB_STATE_LIVE = 'live';
const DP_PUB_STATE_PREVIEW = 'preview';
const DP_PUB_STATES = [DP_PUB_STATE_LIVE, DP_PUB_STATE_PREVIEW];
const NON_WRITABLE_ATTRIBUTES = [ID_ATTRIBUTE, CREATED_BY_ATTRIBUTE, UPDATED_BY_ATTRIBUTE];
const NON_VISIBLE_ATTRIBUTES = [...NON_WRITABLE_ATTRIBUTES, PUBLISHED_AT_ATTRIBUTE];
const constants = {
  ID_ATTRIBUTE,
  PUBLISHED_AT_ATTRIBUTE,
  CREATED_BY_ATTRIBUTE,
  UPDATED_BY_ATTRIBUTE,
  DP_PUB_STATES,
  DP_PUB_STATE_LIVE,
  DP_PUB_STATE_PREVIEW,
  SINGLE_TYPE,
  COLLECTION_TYPE
};

const getTimestamps = model => {
  const timestamps = _.get(model, 'options.timestamps', []);

  if (!_.isArray(timestamps)) {
    return [];
  }

  return timestamps;
};

const getTimestampsAttributes = model => {
  const timestamps = getTimestamps(model);
  return timestamps.reduce((attributes, attributeName) => ({ ...attributes,
    [attributeName]: {
      type: 'timestamp'
    }
  }), {});
};

const getNonWritableAttributes = (model = {}) => {
  const nonWritableAttributes = _.reduce(model.attributes, (acc, attr, attrName) => attr.writable === false ? acc.concat(attrName) : acc, []);

  return _.uniq(NON_WRITABLE_ATTRIBUTES.concat(model.primaryKey, getTimestamps(model), nonWritableAttributes));
};

const getWritableAttributes = model => _.difference(Object.keys(model.attributes), getNonWritableAttributes(model));

const getNonVisibleAttributes = model => _.uniq([model.primaryKey, ...getTimestamps(model), ...NON_VISIBLE_ATTRIBUTES]);

const getVisibleAttributes = model => _.difference(_.keys(model.attributes), getNonVisibleAttributes(model));

const hasDraftAndPublish = model => _.get(model, 'options.draftAndPublish', false) === true;

const isDraft = (data, model) => hasDraftAndPublish(model) && _.get(data, PUBLISHED_AT_ATTRIBUTE) === null;

const isSingleType = ({
  kind = COLLECTION_TYPE
}) => kind === SINGLE_TYPE;

const isCollectionType = ({
  kind = COLLECTION_TYPE
}) => kind === COLLECTION_TYPE;

const isKind = kind => model => model.kind === kind;

const getPrivateAttributes = model => _.union(sgApp.config.get('api.responses.privateAttributes', []), _.get(model, 'options.privateAttributes', []), _.keys(_.pickBy(model.attributes, attr => !!attr.private)));

const isPrivateAttribute = (model = {}, attributeName) => model && model.privateAttributes && model.privateAttributes.includes(attributeName);

const isScalarAttribute = attribute => !attribute.collection && !attribute.model && attribute.type !== 'component' && attribute.type !== 'dynamiczone';

const isMediaAttribute = attr => (attr.collection || attr.model) === 'file' && attr.plugin === 'upload';

module.exports = {
  isScalarAttribute,
  isMediaAttribute,
  getPrivateAttributes,
  getTimestampsAttributes,
  isPrivateAttribute,
  constants,
  getNonWritableAttributes,
  getWritableAttributes,
  getNonVisibleAttributes,
  getVisibleAttributes,
  hasDraftAndPublish,
  isDraft,
  isSingleType,
  isCollectionType,
  isKind
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRlbnQtdHlwZXMudXRpbC5qcyJdLCJuYW1lcyI6WyJfIiwicmVxdWlyZSIsIlNJTkdMRV9UWVBFIiwiQ09MTEVDVElPTl9UWVBFIiwiSURfQVRUUklCVVRFIiwiUFVCTElTSEVEX0FUX0FUVFJJQlVURSIsIkNSRUFURURfQllfQVRUUklCVVRFIiwiVVBEQVRFRF9CWV9BVFRSSUJVVEUiLCJEUF9QVUJfU1RBVEVfTElWRSIsIkRQX1BVQl9TVEFURV9QUkVWSUVXIiwiRFBfUFVCX1NUQVRFUyIsIk5PTl9XUklUQUJMRV9BVFRSSUJVVEVTIiwiTk9OX1ZJU0lCTEVfQVRUUklCVVRFUyIsImNvbnN0YW50cyIsImdldFRpbWVzdGFtcHMiLCJtb2RlbCIsInRpbWVzdGFtcHMiLCJnZXQiLCJpc0FycmF5IiwiZ2V0VGltZXN0YW1wc0F0dHJpYnV0ZXMiLCJyZWR1Y2UiLCJhdHRyaWJ1dGVzIiwiYXR0cmlidXRlTmFtZSIsInR5cGUiLCJnZXROb25Xcml0YWJsZUF0dHJpYnV0ZXMiLCJub25Xcml0YWJsZUF0dHJpYnV0ZXMiLCJhY2MiLCJhdHRyIiwiYXR0ck5hbWUiLCJ3cml0YWJsZSIsImNvbmNhdCIsInVuaXEiLCJwcmltYXJ5S2V5IiwiZ2V0V3JpdGFibGVBdHRyaWJ1dGVzIiwiZGlmZmVyZW5jZSIsIk9iamVjdCIsImtleXMiLCJnZXROb25WaXNpYmxlQXR0cmlidXRlcyIsImdldFZpc2libGVBdHRyaWJ1dGVzIiwiaGFzRHJhZnRBbmRQdWJsaXNoIiwiaXNEcmFmdCIsImRhdGEiLCJpc1NpbmdsZVR5cGUiLCJraW5kIiwiaXNDb2xsZWN0aW9uVHlwZSIsImlzS2luZCIsImdldFByaXZhdGVBdHRyaWJ1dGVzIiwidW5pb24iLCJzZ0FwcCIsImNvbmZpZyIsInBpY2tCeSIsInByaXZhdGUiLCJpc1ByaXZhdGVBdHRyaWJ1dGUiLCJwcml2YXRlQXR0cmlidXRlcyIsImluY2x1ZGVzIiwiaXNTY2FsYXJBdHRyaWJ1dGUiLCJhdHRyaWJ1dGUiLCJjb2xsZWN0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c291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbWF4LWxlbiAqL1xuY29uc3QgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xuXG5jb25zdCBTSU5HTEVfVFlQRSA9ICdzaW5nbGVUeXBlJztcbmNvbnN0IENPTExFQ1RJT05fVFlQRSA9ICdjb2xsZWN0aW9uVHlwZSc7XG5cbmNvbnN0IElEX0FUVFJJQlVURSA9ICdpZCc7XG5jb25zdCBQVUJMSVNIRURfQVRfQVRUUklCVVRFID0gJ3B1Ymxpc2hlZF9hdCc7XG5jb25zdCBDUkVBVEVEX0JZX0FUVFJJQlVURSA9ICdjcmVhdGVkX2J5JztcbmNvbnN0IFVQREFURURfQllfQVRUUklCVVRFID0gJ3VwZGF0ZWRfYnknO1xuY29uc3QgRFBfUFVCX1NUQVRFX0xJVkUgPSAnbGl2ZSc7XG5jb25zdCBEUF9QVUJfU1RBVEVfUFJFVklFVyA9ICdwcmV2aWV3JztcbmNvbnN0IERQX1BVQl9TVEFURVMgPSBbRFBfUFVCX1NUQVRFX0xJVkUsIERQX1BVQl9TVEFURV9QUkVWSUVXXTtcblxuY29uc3QgTk9OX1dSSVRBQkxFX0FUVFJJQlVURVMgPSBbSURfQVRUUklCVVRFLCBDUkVBVEVEX0JZX0FUVFJJQlVURSwgVVBEQVRFRF9CWV9BVFRSSUJVVEVdO1xuY29uc3QgTk9OX1ZJU0lCTEVfQVRUUklCVVRFUyA9IFsuLi5OT05fV1JJVEFCTEVfQVRUUklCVVRFUywgUFVCTElTSEVEX0FUX0FUVFJJQlVURV07XG5cbmNvbnN0IGNvbnN0YW50cyA9IHtcbiAgSURfQVRUUklCVVRFLFxuICBQVUJMSVNIRURfQVRfQVRUUklCVVRFLFxuXG4gIENSRUFURURfQllfQVRUUklCVVRFLFxuICBVUERBVEVEX0JZX0FUVFJJQlVURSxcbiAgRFBfUFVCX1NUQVRFUyxcbiAgRFBfUFVCX1NUQVRFX0xJVkUsXG4gIERQX1BVQl9TVEFURV9QUkVWSUVXLFxuICBTSU5HTEVfVFlQRSxcbiAgQ09MTEVDVElPTl9UWVBFLFxufTtcblxuY29uc3QgZ2V0VGltZXN0YW1wcyA9IChtb2RlbCkgPT4ge1xuICBjb25zdCB0aW1lc3RhbXBzID0gXy5nZXQobW9kZWwsICdvcHRpb25zLnRpbWVzdGFtcHMnLCBbXSk7XG5cbiAgaWYgKCFfLmlzQXJyYXkodGltZXN0YW1wcykpIHtcbiAgICByZXR1cm4gW107XG4gIH1cblxuICByZXR1cm4gdGltZXN0YW1wcztcbn07XG5cbmNvbnN0IGdldFRpbWVzdGFtcHNBdHRyaWJ1dGVzID0gKG1vZGVsKSA9PiB7XG4gIGNvbnN0IHRpbWVzdGFtcHMgPSBnZXRUaW1lc3RhbXBzKG1vZGVsKTtcblxuICByZXR1cm4gdGltZXN0YW1wcy5yZWR1Y2UoXG4gICAgKGF0dHJpYnV0ZXMsIGF0dHJpYnV0ZU5hbWUpID0+ICh7XG4gICAgICAuLi5hdHRyaWJ1dGVzLFxuICAgICAgW2F0dHJpYnV0ZU5hbWVdOiB7IHR5cGU6ICd0aW1lc3RhbXAnIH0sXG4gICAgfSksXG4gICAge30sXG4gICk7XG59O1xuXG5jb25zdCBnZXROb25Xcml0YWJsZUF0dHJpYnV0ZXMgPSAobW9kZWwgPSB7fSkgPT4ge1xuICBjb25zdCBub25Xcml0YWJsZUF0dHJpYnV0ZXMgPSBfLnJlZHVjZShcbiAgICBtb2RlbC5hdHRyaWJ1dGVzLFxuICAgIChhY2MsIGF0dHIsIGF0dHJOYW1lKSA9PiAoYXR0ci53cml0YWJsZSA9PT0gZmFsc2UgPyBhY2MuY29uY2F0KGF0dHJOYW1lKSA6IGFjYyksXG4gICAgW10sXG4gICk7XG5cbiAgcmV0dXJuIF8udW5pcShcbiAgICBOT05fV1JJVEFCTEVfQVRUUklCVVRFUy5jb25jYXQobW9kZWwucHJpbWFyeUtleSwgZ2V0VGltZXN0YW1wcyhtb2RlbCksIG5vbldyaXRhYmxlQXR0cmlidXRlcyksXG4gICk7XG59O1xuXG5jb25zdCBnZXRXcml0YWJsZUF0dHJpYnV0ZXMgPSAobW9kZWwpID0+IF8uZGlmZmVyZW5jZShPYmplY3Qua2V5cyhtb2RlbC5hdHRyaWJ1dGVzKSwgZ2V0Tm9uV3JpdGFibGVBdHRyaWJ1dGVzKG1vZGVsKSk7XG5cbmNvbnN0IGdldE5vblZpc2libGVBdHRyaWJ1dGVzID0gKG1vZGVsKSA9PiBfLnVuaXEoW21vZGVsLnByaW1hcnlLZXksIC4uLmdldFRpbWVzdGFtcHMobW9kZWwpLCAuLi5OT05fVklTSUJMRV9BVFRSSUJVVEVTXSk7XG5cbmNvbnN0IGdldFZpc2libGVBdHRyaWJ1dGVzID0gKG1vZGVsKSA9PiBfLmRpZmZlcmVuY2UoXy5rZXlzKG1vZGVsLmF0dHJpYnV0ZXMpLCBnZXROb25WaXNpYmxlQXR0cmlidXRlcyhtb2RlbCkpO1xuXG5jb25zdCBoYXNEcmFmdEFuZFB1Ymxpc2ggPSAobW9kZWwpID0+IF8uZ2V0KG1vZGVsLCAnb3B0aW9ucy5kcmFmdEFuZFB1Ymxpc2gnLCBmYWxzZSkgPT09IHRydWU7XG5cbmNvbnN0IGlzRHJhZnQgPSAoZGF0YSwgbW9kZWwpID0+IGhhc0RyYWZ0QW5kUHVibGlzaChtb2RlbCkgJiYgXy5nZXQoZGF0YSwgUFVCTElTSEVEX0FUX0FUVFJJQlVURSkgPT09IG51bGw7XG5cbmNvbnN0IGlzU2luZ2xlVHlwZSA9ICh7IGtpbmQgPSBDT0xMRUNUSU9OX1RZUEUgfSkgPT4ga2luZCA9PT0gU0lOR0xFX1RZUEU7XG5jb25zdCBpc0NvbGxlY3Rpb25UeXBlID0gKHsga2luZCA9IENPTExFQ1RJT05fVFlQRSB9KSA9PiBraW5kID09PSBDT0xMRUNUSU9OX1RZUEU7XG5jb25zdCBpc0tpbmQgPSAoa2luZCkgPT4gKG1vZGVsKSA9PiBtb2RlbC5raW5kID09PSBraW5kO1xuXG5jb25zdCBnZXRQcml2YXRlQXR0cmlidXRlcyA9IChtb2RlbCkgPT4gXy51bmlvbihcbiAgc2dBcHAuY29uZmlnLmdldCgnYXBpLnJlc3BvbnNlcy5wcml2YXRlQXR0cmlidXRlcycsIFtdKSxcbiAgXy5nZXQobW9kZWwsICdvcHRpb25zLnByaXZhdGVBdHRyaWJ1dGVzJywgW10pLFxuICBfLmtleXMoXy5waWNrQnkobW9kZWwuYXR0cmlidXRlcywgKGF0dHIpID0+ICEhYXR0ci5wcml2YXRlKSksXG4pO1xuXG5jb25zdCBpc1ByaXZhdGVBdHRyaWJ1dGUgPSAobW9kZWwgPSB7fSwgYXR0cmlidXRlTmFtZSkgPT4gbW9kZWwgJiYgbW9kZWwucHJpdmF0ZUF0dHJpYnV0ZXMgJiYgbW9kZWwucHJpdmF0ZUF0dHJpYnV0ZXMuaW5jbHVkZXMoYXR0cmlidXRlTmFtZSk7XG5cbmNvbnN0IGlzU2NhbGFyQXR0cmlidXRlID0gKGF0dHJpYnV0ZSkgPT4gKFxuICAhYXR0cmlidXRlLmNvbGxlY3Rpb25cbiAgJiYgIWF0dHJpYnV0ZS5tb2RlbFxuICAmJiBhdHRyaWJ1dGUudHlwZSAhPT0gJ2NvbXBvbmVudCdcbiAgJiYgYXR0cmlidXRlLnR5cGUgIT09ICdkeW5hbWljem9uZSdcbik7XG5cbmNvbnN0IGlzTWVkaWFBdHRyaWJ1dGUgPSAoYXR0cikgPT4gKGF0dHIuY29sbGVjdGlvbiB8fCBhdHRyLm1vZGVsKSA9PT0gJ2ZpbGUnICYmIGF0dHIucGx1Z2luID09PSAndXBsb2FkJztcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGlzU2NhbGFyQXR0cmlidXRlLFxuICBpc01lZGlhQXR0cmlidXRlLFxuICBnZXRQcml2YXRlQXR0cmlidXRlcyxcbiAgZ2V0VGltZXN0YW1wc0F0dHJpYnV0ZXMsXG4gIGlzUHJpdmF0ZUF0dHJpYnV0ZSxcbiAgY29uc3RhbnRzLFxuICBnZXROb25Xcml0YWJsZUF0dHJpYnV0ZXMsXG4gIGdldFdyaXRhYmxlQXR0cmlidXRlcyxcbiAgZ2V0Tm9uVmlzaWJsZUF0dHJpYnV0ZXMsXG4gIGdldFZpc2libGVBdHRyaWJ1dGVzLFxuICBoYXNEcmFmdEFuZFB1Ymxpc2gsXG4gIGlzRHJhZnQsXG4gIGlzU2luZ2xlVHlwZSxcbiAgaXNDb2xsZWN0aW9uVHlwZSxcbiAgaXNLaW5kLFxufTtcbiJdfQ==